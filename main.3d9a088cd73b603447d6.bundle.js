(()=>{"use strict";const t=class{};class e{constructor(t=1,e=1,s=1,i=1){this.r=t,this.g=e,this.b=s,this.a=i}static get BLACK(){return new e(0,0,0,1)}static get WHITE(){return new e(1,1,1,1)}static get RED(){return new e(1,0,0,1)}static get GREEN(){return new e(0,1,0,1)}static get BLUE(){return new e(0,0,1,1)}static get YELLOW(){return new e(1,1,0,1)}static get CYAN(){return new e(0,1,1,1)}static get MAGENTA(){return new e(1,0,1,1)}static get GREY(){return new e(.5,.5,.5,1)}static get CLEAR(){return new e(1,1,1,0)}static get RANDOM_OPAQUE(){return new e(n.randomRange(0,1),n.randomRange(0,1),n.randomRange(0,1),1)}static fromHex(t){t.startsWith("#")&&(t=t.substring(1));const s=parseInt(t,16);return new e((s>>16&255)/255,(s>>8&255)/255,(255&s)/255)}static fromHsv(t,s,i,n=1){let r,o,a;if(0==s)r=o=a=i;else{const e=function(t,e,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?t+6*(e-t)*s:s<.5?e:s<2/3?t+(e-t)*(2/3-s)*6:t},n=i<.5?i*(1+s):i+s-i*s,h=2*i-n;r=e(h,n,t+1/3),o=e(h,n,t),a=e(h,n,t-1/3)}return new e(r,o,a,n)}toString(){function t(t){return Math.round(255*t)}return`rgba(${t(this.r)}, ${t(this.g)}, ${t(this.b)}, ${this.a})`}add(t){const s=this.r+t.r,i=this.g+t.g,n=this.b+t.b,r=this.a+t.a,o=Math.max(0,Math.min(1,s)),a=Math.max(0,Math.min(1,i)),h=Math.max(0,Math.min(1,n)),l=Math.max(0,Math.min(1,r));return new e(o,a,h,l)}}const s=e;class i{static clamp(t,e,s){return t<e?e:t>s?s:t}static sign(t){return t>0?1:t<0?-1:0}static randomRange(t,e){return Math.random()*(e-t)+t}static randomRangeInt(t,e){return Math.round(i.randomRange(t,e))+t}static randomIntBag(t,e,s){const i=Array.from({length:e-t},((e,s)=>s+t)),n=[];for(;n.length<s&&i.length>0;){const t=Math.floor(Math.random()*i.length);n.push(i[t]),i.splice(t,1)}return n}static lerpNumber(t,e,s){return(s-e)*t+e}static lerpVector(t,e,s){return s.subtract(e).multiply(t).add(e)}static lerpColor(t,e,n){return new s(i.lerpNumber(t,e.r,n.r),i.lerpNumber(t,e.g,n.g),i.lerpNumber(t,e.b,n.b),i.lerpNumber(t,e.a,n.a))}}i.rad2Deg=180/Math.PI,i.deg2Rad=Math.PI/180;const n=i;class r{constructor(t,e,s=1){this.x=t,this.y=e,this.z=s}static get LEFT(){return new r(-1,0,0)}static get RIGHT(){return new r(1,0,0)}static get UP(){return new r(0,1,0)}static get DOWN(){return new r(0,-1,0)}static get ZERO(){return new r(0,0,0)}static get ONE(){return new r(1,1,1)}static get RANDOM_UNIT(){return new r(n.randomRange(-1,1),n.randomRange(-1,1)).normalized()}static ANGLE_UNIT(t){const e=Math.cos(t*n.deg2Rad),s=Math.sin(t*n.deg2Rad);return new r(e,s,0)}static distance(t,e){return t.subtract(e).length()}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}normalized(){const t=this.length();return 0!==t?new r(this.x/t,this.y/t,0):new r(0,0,0)}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}cross(t){const e=this.y*t.z-this.z*t.y,s=this.z*t.x-this.x*t.z,i=this.x*t.y-this.y*t.x;return new r(e,s,i)}angle(t){const e=this.dot(t),s=this.length()*t.length();return Math.acos(e/s)*(180/Math.PI)}copy(){return new r(this.x,this.y,this.z)}toString(){return`Vector(${this.x}, ${this.y}, ${this.z})`}add(t){return new r(this.x+t.x,this.y+t.y,this.z+t.z)}subtract(t){return new r(this.x-t.x,this.y-t.y,this.z-t.z)}multiply(t){return new r(this.x*t,this.y*t,this.z*t)}multiplyComp(t){return new r(this.x*t.x,this.y*t.y,this.z*t.z)}equal(t,e=!1){return Math.abs(this.x-t.x)<Number.EPSILON&&Math.abs(this.y-t.y)<Number.EPSILON&&(!e||Math.abs(this.z-t.z)<Number.EPSILON)}withX(t){return new r(t,this.y,this.z)}withY(t){return new r(this.x,t,this.z)}xx(){return new r(this.x,this.x,this.z)}yy(){return new r(this.y,this.y,this.z)}xy(){return new r(this.x,this.y,this.z)}yx(){return new r(this.y,this.x,this.z)}}const o=r;class a{constructor(t=0,e=0,s=0,i=0,n=0,r=0,o=0,a=0,h=0){this.values=[],this.values=[[t,e,s],[i,n,r],[o,a,h]]}static get ZERO(){return new a(0,0,0,0,0,0,0,0,0)}static get IDENTITY(){return new a(1,0,0,0,1,0,0,0,1)}static translate(t,e){const s=a.IDENTITY;return s.values[0][2]=t,s.values[1][2]=e,s}static rotate(t){const e=a.IDENTITY,s=Math.cos(t*n.deg2Rad),i=Math.sin(t*n.deg2Rad);return e.values[0][0]=s,e.values[0][1]=-i,e.values[1][0]=i,e.values[1][1]=s,e}static scale(t,e){const s=a.IDENTITY;return s.values[0][0]=t,s.values[1][1]=e,s}determinant(){const t=this.values[0][0],e=this.values[0][1],s=this.values[0][2],i=this.values[1][0],n=this.values[1][1],r=this.values[1][2],o=this.values[2][0],a=this.values[2][1],h=this.values[2][2];return t*(n*h-r*a)-e*(i*h-r*o)+s*(i*a-n*o)}inverse(){const t=this.determinant();if(0===t)throw new Error("Matrix is not invertible.");const e=new a,s=1/t;return e.values[0][0]=(this.values[1][1]*this.values[2][2]-this.values[1][2]*this.values[2][1])*s,e.values[0][1]=(this.values[0][2]*this.values[2][1]-this.values[0][1]*this.values[2][2])*s,e.values[0][2]=(this.values[0][1]*this.values[1][2]-this.values[0][2]*this.values[1][1])*s,e.values[1][0]=(this.values[1][2]*this.values[2][0]-this.values[1][0]*this.values[2][2])*s,e.values[1][1]=(this.values[0][0]*this.values[2][2]-this.values[0][2]*this.values[2][0])*s,e.values[1][2]=(this.values[0][2]*this.values[1][0]-this.values[0][0]*this.values[1][2])*s,e.values[2][0]=(this.values[1][0]*this.values[2][1]-this.values[1][1]*this.values[2][0])*s,e.values[2][1]=(this.values[0][1]*this.values[2][0]-this.values[0][0]*this.values[2][1])*s,e.values[2][2]=(this.values[0][0]*this.values[1][1]-this.values[0][1]*this.values[1][0])*s,e}transpose(){const t=new a;for(let e=0;e<3;e++)for(let s=0;s<3;s++)t.values[e][s]=this.values[s][e];return t}multiplyMatrix(t){const e=new a,s=this.values,i=t.values,n=e.values,r=s[0][0],o=s[0][1],h=s[0][2],l=s[1][0],c=s[1][1],u=s[1][2],d=s[2][0],_=s[2][1],g=s[2][2],m=i[0][0],p=i[0][1],w=i[0][2],b=i[1][0],C=i[1][1],T=i[1][2],E=i[2][0],f=i[2][1],R=i[2][2];return n[0][0]=r*m+o*b+h*E,n[0][1]=r*p+o*C+h*f,n[0][2]=r*w+o*T+h*R,n[1][0]=l*m+c*b+u*E,n[1][1]=l*p+c*C+u*f,n[1][2]=l*w+c*T+u*R,n[2][0]=d*m+_*b+g*E,n[2][1]=d*p+_*C+g*f,n[2][2]=d*w+_*T+g*R,e}matrixMultiplyComponentWise(t){const e=new a;for(let s=0;s<3;s++)for(let i=0;i<3;i++)e.values[s][i]=this.values[s][i]*t.values[s][i];return e}multiplyVector(t){return new o(this.values[0][0]*t.x+this.values[0][1]*t.y+this.values[0][2]*t.z,this.values[1][0]*t.x+this.values[1][1]*t.y+this.values[1][2]*t.z,this.values[2][0]*t.x+this.values[2][1]*t.y+this.values[2][2]*t.z)}toString(){return`[${this.values[0][0]}, ${this.values[0][1]}, ${this.values[0][2]}],\n            [${this.values[1][0]}, ${this.values[1][1]}, ${this.values[1][2]}],\n            [${this.values[2][0]}, ${this.values[2][1]}, ${this.values[2][2]}]`}}const h=a;class l{static _init(t,e){l._isDebugging=t,l._showFps=e,l.log("Debug initialized.")}static assert(t,e){l._isDebugging&&console.assert(t,e)}static log(t){l._isDebugging&&console.log(t)}static logError(t){l._isDebugging&&console.error(t)}}l._showFps=!0;const c=l;class u{static _init(){u._startTime=performance.now(),c.log("Time initialized.")}static time(){return Date.now()/1e3}static timeSinceGameStart(){return u.isPaused?0:u._timeSinceGameStart}static deltaTime(){return u.isPaused?0:(performance.now()-u._lastFrameTime)/1e3}static _handleTimer(){if(u.isPaused)return;const t=u.deltaTime();u._timers.forEach(((e,s)=>e.evaluate(t))),u._timeSinceGameStart+=u.deltaTime()}static _registerTimer(t){u._timers.set(t.guid,t)}static _unregisterTimer(t){u._timers.delete(t.guid)}}u.isPaused=!1,u._timeSinceGameStart=0,u._timers=new Map;const d=u;var _;!function(t){t[t.DEFAULT=0]="DEFAULT",t[t.UI=1]="UI",t[t.RED=2]="RED",t[t.GREEN=3]="GREEN",t[t.BLUE=4]="BLUE"}(_||(_={}));const g=_;class m{static get canvasSize(){return this._canvasSize}static _init(t,e){m._canvasContext=t,this._canvasSize=e;const s=h.translate(m._canvasSize.x/2,m._canvasSize.y/2),i=h.scale(1,-1);this._worldToCameraMatrix=s.multiplyMatrix(i);for(const t in g)m._renderers.set(g[t],[]);c.log("Canvas initialized.")}static _draw(){m._canvasContext.clearRect(0,0,m._canvasSize.x,m._canvasSize.y),m._canvasContext.fillStyle=m.backgroundColor.toString(),m._canvasContext.fillRect(0,0,m._canvasSize.x,m._canvasSize.y);for(const t in g){const e=g[t],s=m._renderers.get(e).sort(((t,e)=>t.drawOrder>e.drawOrder?1:-1));for(let t=0;t<s.length;t++)m._drawRenderer(s[t])}c._showFps&&(m._canvasContext.font="30px verdana",m._canvasContext.textAlign="left",m._canvasContext.fillStyle=s.MAGENTA.toString(),m._canvasContext.fillText("FPS: "+Math.round(1/d.deltaTime()),50,50))}static _registerRenderer(t){var e;null===(e=this._renderers.get(t.drawLayer))||void 0===e||e.push(t)}static _unregisterRenderer(t){this._renderers.set(t.drawLayer,this._renderers.get(t.drawLayer).filter((e=>e!==t)))}static _drawRenderer(t){const e=t._localToWorldMatrix().multiplyMatrix(h.scale(1,-1)),s=m._worldToCameraMatrix.multiplyMatrix(e);m._canvasContext.setTransform(s.values[0][0],s.values[1][0],s.values[0][1],s.values[1][1],s.values[0][2],s.values[1][2]),t._draw(d.deltaTime()),m._canvasContext.resetTransform()}}m.backgroundColor=s.WHITE,m._renderers=new Map,m._canvasSize=new o(400,600);const p=m;class w{static _init(t){document.addEventListener("mouseup",(t=>{w._isMouseUpLastFrame=!0}),!1),document.addEventListener("mousedown",(t=>{w._isMouseDownLastFrame=!0}),!1),document.addEventListener("keyup",(t=>{w._lastKeyUpKey=t.key}),!1),document.addEventListener("keydown",(t=>{w._lastKeyDownKey=t.key}),!1),document.onmousemove=t=>{t&&(w._lastMousePosition=new o(t.clientX,t.clientY,1))},c.log("Input initialized.")}static _handleInput(){for(let t=0;t<this._mouseInteractables.length;t++)this._mouseInteractables[t].owner.isActive&&(this._mouseInteractables[t]._checkClick(w.getMousePosition()),this._mouseInteractables[t]._checkHover(w.getMousePosition()))}static _resetInput(){w._isMouseUpLastFrame=!1,w._isMouseDownLastFrame=!1,w._lastKeyUpKey="",w._lastKeyDownKey=""}static registerMouseInteractable(t){this._mouseInteractables.push(t)}static getKeyDown(t){return w._lastKeyDownKey==t}static getKeyUp(t){return w._lastKeyUpKey==t}static getMouseDown(){return w._isMouseDownLastFrame}static getMouseUp(){return w._isMouseUpLastFrame}static getMousePosition(){return this._lastMousePosition?p._worldToCameraMatrix.inverse().multiplyVector(this._lastMousePosition):o.ZERO}}w._mouseInteractables=[],w._isMouseDownLastFrame=!1,w._isMouseUpLastFrame=!1;const b=w;var C;!function(t){t[t.TRANSFORM=0]="TRANSFORM",t[t.RENDERER=1]="RENDERER",t[t.RECTANGLE_COLLIDER=2]="RECTANGLE_COLLIDER",t[t.CIRCLE_COLLIDER=3]="CIRCLE_COLLIDER",t[t.RIGIDBODY=4]="RIGIDBODY",t[t.BUTTON=5]="BUTTON",t[t.TEXT=6]="TEXT",t[t.ANIMATOR=7]="ANIMATOR",t[t.PARTICLE_EMITTER=8]="PARTICLE_EMITTER"}(C||(C={}));const T=C;class E{static generate(){return this.currentId++}}E.currentId=0;const f=E,R=class{constructor(t){this.isActive=!0,this._componentRequirements=[],this.owner=t,this.guid=f.generate()}};class S{constructor(){this._eventCallbacks=[]}subscribe(t){this._eventCallbacks.push(t)}unsubscribe(t){this._eventCallbacks=this._eventCallbacks.filter((e=>e!==t))}invoke(){for(const t of this._eventCallbacks)t()}}class v{constructor(){this._eventCallbacks=[]}subscribe(t){this._eventCallbacks.push(t)}unsubscribe(t){this._eventCallbacks=this._eventCallbacks.filter((e=>e!==t))}invoke(t){for(const e of this._eventCallbacks)e(t)}}const I=class extends R{constructor(t){super(t),this._componentRequirements=[T.TRANSFORM],this.collisionStarted=new v,this.collisionHappening=new v,this.collisionEnded=new v,this._currentFrameCollidingColliders=[],this._lastFrameCollidingColliders=[],A._registerCollider(this),this._ownerTransform=t.getComponent(T.TRANSFORM)}_getWorldPosition(){return this._ownerTransform.globalPosition.add(this.offset)}_addCollidingCollider(t){this._currentFrameCollidingColliders.push(t),-1===this._lastFrameCollidingColliders.findIndex((e=>e===t))?this.collisionStarted.invoke(t):this.collisionHappening.invoke(t)}_confirmCollidingColliders(){for(const t of this._lastFrameCollidingColliders)-1===this._currentFrameCollidingColliders.findIndex((e=>e===t))&&this.collisionEnded.invoke(t);this._lastFrameCollidingColliders=this._currentFrameCollidingColliders}},x=class{constructor(t,e){this.center=t,this.size=e}isPointInside(t){return t.x>=this.center.x-this.size.x/2&&t.x<=this.center.x+this.size.x/2&&t.y>=this.center.y-this.size.y/2&&t.y<=this.center.y+this.size.y/2}},O=class extends I{constructor(t,e=o.ONE,s=o.ZERO){super(t),this.type=T.RECTANGLE_COLLIDER,this._componentRequirements=[T.TRANSFORM],this.size=e,this.offset=s}AABB(){const t=this._ownerTransform.globalPosition;return new x(t.add(this.offset),this.size)}},N=class extends I{constructor(t,e=1,s=o.ZERO){super(t),this.type=T.CIRCLE_COLLIDER,this._componentRequirements=[T.TRANSFORM],this.radius=e,this.offset=s}AABB(){const t=this._ownerTransform.globalPosition;return new x(t.add(this.offset),o.ONE.multiply(2))}};var y;!function(t){t[t.DEFAULT=0]="DEFAULT",t[t.IGNORE=1]="IGNORE"}(y||(y={}));const P=y;class M{static _registerCollider(t){this._colliders.push(t)}static _unregisterCollider(t){this._colliders=this._colliders.filter((e=>e!==t))}static _registerRigidbody(t){this._colliders=this._colliders.filter((e=>e.owner.getGuid()!==t.owner.getGuid())),this._rigidbodies.push(t)}static _handlePhysics(){M._handleRigidbodies(),M._handleColliders()}static _handleRigidbodies(){for(let t=0;t<M.substep;t++){const t=d.deltaTime()/M.substep;M._applyGravity(),M._solveCollision(t),M._applyConstraint(),M._updatePosition(t)}}static _updatePosition(t){for(let e=0;e<M._rigidbodies.length;e++)M._rigidbodies[e].isActive&&M._rigidbodies[e].owner.isActive&&M._rigidbodies[e]._updatePosition(t)}static _applyGravity(){for(let t=0;t<M._rigidbodies.length;t++)M._rigidbodies[t].isActive&&M._rigidbodies[t].owner.isActive&&(M._rigidbodies[t].overrideGravity?M._rigidbodies[t].accelerate(M._rigidbodies[t].overrideGravity):M._rigidbodies[t].accelerate(M.gravity))}static _solveCollision(t){for(let t=0;t<M._rigidbodies.length;t++){if(!M._rigidbodies[t].isActive||!M._rigidbodies[t].owner.isActive)continue;const e=M._rigidbodies[t];if(e.collisionLayer!==P.IGNORE){for(let s=t+1;s<M._rigidbodies.length;s++){if(!M._rigidbodies[s].isActive||!M._rigidbodies[s].owner.isActive)continue;const t=M._rigidbodies[s];if(e.collisionLayer!==t.collisionLayer)continue;const i=e.owner.getComponent(T.CIRCLE_COLLIDER),n=t.owner.getComponent(T.CIRCLE_COLLIDER),r=i._ownerTransform.globalPosition.copy(),a=n._ownerTransform.globalPosition.copy(),h=o.distance(r,a),l=i.radius*i._ownerTransform.scale.x+n.radius*n._ownerTransform.scale.x;if(h>l)continue;const c=r.subtract(a).normalized(),u=e.mass/(e.mass+t.mass),d=t.mass/(e.mass+t.mass),_=.5*(l-h);i._ownerTransform.globalPosition=r.add(c.multiply(d*_)),n._ownerTransform.globalPosition=a.subtract(c.multiply(u*_)),this._broadcastCollision(i,n)}for(let t=0;t<M._colliders.length;t++)if(M._colliders[t].type===T.CIRCLE_COLLIDER){const s=e.owner.getComponent(T.CIRCLE_COLLIDER),i=M._colliders[t],n=s._ownerTransform.globalPosition.copy(),r=i._ownerTransform.globalPosition.copy(),a=o.distance(n,r),h=s.radius*s._ownerTransform.scale.x+i.radius*i._ownerTransform.scale.x;if(a>h)continue;const l=n.subtract(r).normalized(),c=.5*(h-a);s._ownerTransform.globalPosition=n.add(l.multiply(c)),this._broadcastCollision(s,i)}else if(M._colliders[t].type===T.RECTANGLE_COLLIDER){const s=e.owner.getComponent(T.CIRCLE_COLLIDER),i=M._colliders[t],n=s._ownerTransform.globalPosition.copy(),r=i._ownerTransform.globalPosition.copy(),a=i._ownerTransform.rotation,l=h.rotate(-a).multiplyVector(n.subtract(r)),c=Math.abs(l.x)-s.radius-i.size.x/2,u=Math.abs(l.y)-s.radius-i.size.y/2;if(c>=0||u>=0)continue;let d=o.ZERO,_=0;c<u?(d=l.y>0?o.UP:o.DOWN,_=Math.abs(u)):(d=l.x>0?o.RIGHT:o.LEFT,_=Math.abs(c)),d=h.rotate(a).multiplyVector(d),s._ownerTransform.globalPosition=n.add(d.multiply(_)),this._broadcastCollision(s,i)}}}}static _applyConstraint(){for(let t=0;t<M._rigidbodies.length;t++){if(!M._rigidbodies[t].isActive||!M._rigidbodies[t].owner.isActive)continue;const e=M._rigidbodies[t].ownerTransform.globalPosition.copy(),s=M._rigidbodies[t].owner.getComponent(T.CIRCLE_COLLIDER).radius;e.length()+s<=M.constraintRadius||(M._rigidbodies[t].ownerTransform.globalPosition=e.normalized().multiply(M.constraintRadius-s))}}static _handleColliders(){for(let t=0;t<this._colliders.length;t++)for(let e=t+1;e<this._colliders.length;e++)if(this._colliders[t].isActive&&this._colliders[t].owner.isActive&&this._colliders[e].isActive&&this._colliders[e].owner.isActive)if(this._colliders[t]instanceof O){const s=this._colliders[t];if(this._colliders[e]instanceof O){const t=this._colliders[e],i=s._getWorldPosition(),n=t._getWorldPosition(),r=s.size,o=t.size;Math.abs(i.subtract(n).x)<r.x/2+o.x/2&&Math.abs(i.subtract(n).y)<r.y/2+o.y/2&&M._broadcastCollision(s,t)}else this._colliders[e]instanceof N&&this._colliders[e]}else if(this._colliders[t]instanceof N){const s=this._colliders[t];if(this._colliders[e]instanceof O)this._colliders[e];else if(this._colliders[e]instanceof N){const t=this._colliders[e],i=s._getWorldPosition(),n=t._getWorldPosition(),r=s.radius,a=t.radius;o.distance(i,n)>r+a&&M._broadcastCollision(s,t)}}}static _broadcastCollision(t,e){t._addCollidingCollider(e),e._addCollidingCollider(t)}}M.gravity=new o(0,-9.8),M.positionScale=10,M.substep=4,M.constraintRadius=300,M._colliders=[],M._rigidbodies=[];const A=M;var D;!function(t){t[t.LINEAR=0]="LINEAR",t[t.IN_SINE=1]="IN_SINE",t[t.OUT_SINE=2]="OUT_SINE",t[t.IN_OUT_SINE=3]="IN_OUT_SINE",t[t.IN_CUBIC=4]="IN_CUBIC",t[t.OUT_CUBIC=5]="OUT_CUBIC",t[t.IN_OUT_CUBIC=6]="IN_OUT_CUBIC",t[t.IN_QUINT=7]="IN_QUINT",t[t.OUT_QUINT=8]="OUT_QUINT",t[t.IN_OUT_QUINT=9]="IN_OUT_QUINT",t[t.IN_CIRC=10]="IN_CIRC",t[t.OUT_CIRC=11]="OUT_CIRC",t[t.IN_OUT_CIRC=12]="IN_OUT_CIRC",t[t.IN_ELASTIC=13]="IN_ELASTIC",t[t.OUT_ELASTIC=14]="OUT_ELASTIC",t[t.IN_OUT_ELASTIC=15]="IN_OUT_ELASTIC",t[t.IN_QUAD=16]="IN_QUAD",t[t.OUT_QUAD=17]="OUT_QUAD",t[t.IN_OUT_QUAD=18]="IN_OUT_QUAD",t[t.IN_QUART=19]="IN_QUART",t[t.OUT_QUART=20]="OUT_QUART",t[t.IN_OUT_QUART=21]="IN_OUT_QUART",t[t.IN_EXPO=22]="IN_EXPO",t[t.OUT_EXPO=23]="OUT_EXPO",t[t.IN_OUT_EXPO=24]="IN_OUT_EXPO",t[t.IN_BACK=25]="IN_BACK",t[t.OUT_BACK=26]="OUT_BACK",t[t.IN_OUT_BACK=27]="IN_OUT_BACK"}(D||(D={}));const L=D,U=Math.pow,k=Math.sqrt,B=Math.sin,G=Math.cos,F=Math.PI,z=1.70158,V=1.525*z,Y=z+1,H=2*F/3,W=2*F/4.5,X={[L.LINEAR]:t=>t,[L.IN_QUAD]:function(t){return t*t},[L.OUT_QUAD]:function(t){return 1-(1-t)*(1-t)},[L.IN_OUT_QUAD]:function(t){return t<.5?2*t*t:1-U(-2*t+2,2)/2},[L.IN_CUBIC]:function(t){return t*t*t},[L.OUT_CUBIC]:function(t){return 1-U(1-t,3)},[L.IN_OUT_CUBIC]:function(t){return t<.5?4*t*t*t:1-U(-2*t+2,3)/2},[L.IN_QUART]:function(t){return t*t*t*t},[L.OUT_QUART]:function(t){return 1-U(1-t,4)},[L.IN_OUT_QUART]:function(t){return t<.5?8*t*t*t*t:1-U(-2*t+2,4)/2},[L.IN_QUINT]:function(t){return t*t*t*t*t},[L.OUT_QUINT]:function(t){return 1-U(1-t,5)},[L.IN_OUT_QUINT]:function(t){return t<.5?16*t*t*t*t*t:1-U(-2*t+2,5)/2},[L.IN_SINE]:function(t){return 1-G(t*F/2)},[L.OUT_SINE]:function(t){return B(t*F/2)},[L.IN_OUT_SINE]:function(t){return-(G(F*t)-1)/2},[L.IN_EXPO]:function(t){return 0===t?0:U(2,10*t-10)},[L.OUT_EXPO]:function(t){return 1===t?1:1-U(2,-10*t)},[L.IN_OUT_EXPO]:function(t){return 0===t?0:1===t?1:t<.5?U(2,20*t-10)/2:(2-U(2,-20*t+10))/2},[L.IN_CIRC]:function(t){return 1-k(1-U(t,2))},[L.OUT_CIRC]:function(t){return k(1-U(t-1,2))},[L.IN_OUT_CIRC]:function(t){return t<.5?(1-k(1-U(2*t,2)))/2:(k(1-U(-2*t+2,2))+1)/2},[L.IN_BACK]:function(t){return Y*t*t*t-z*t*t},[L.OUT_BACK]:function(t){return 1+Y*U(t-1,3)+z*U(t-1,2)},[L.IN_OUT_BACK]:function(t){return t<.5?U(2*t,2)*(7.189819*t-V)/2:(U(2*t-2,2)*((V+1)*(2*t-2)+V)+2)/2},[L.IN_ELASTIC]:function(t){return 0===t?0:1===t?1:-U(2,10*t-10)*B((10*t-10.75)*H)},[L.OUT_ELASTIC]:function(t){return 0===t?0:1===t?1:U(2,-10*t)*B((10*t-.75)*H)+1},[L.IN_OUT_ELASTIC]:function(t){return 0===t?0:1===t?1:t<.5?-U(2,20*t-10)*B((20*t-11.125)*W)/2:U(2,-20*t+10)*B((20*t-11.125)*W)/2+1}};class K{static _registerTween(t){this._tweens.push(t)}static _unregisterTween(t){K._tweens=K._tweens.filter((e=>e!=t))}static _handleTween(){const t=[];for(const e of K._tweens){if(e._delay>0){e._delay-=d.deltaTime();continue}e._isStarted||e._start();const s=(d.timeSinceGameStart()-e._startTime)/e._duration,i=X[e._ease](s);e.evaluate(i),e._startTime+e._duration<d.timeSinceGameStart()&&(t.push(e),e.end())}K._tweens=K._tweens.filter((e=>!t.includes(e)))}}K._tweens=[];const j=K;class J{static _init(){c.assert(!J._isInitialized,"Game is already initialized."),J._lastFrameTimestamp=performance.now(),window.requestAnimationFrame(J._gameLoop),c.log("Game is running.")}static _registerRootNode(t){J._rootNodes.push(t)}static _unregisterRootNode(t){J._rootNodes=J._rootNodes.filter((e=>e!==t))}static _gameLoop(){const t=performance.now();d._lastFrameTime=J._lastFrameTimestamp,b._handleInput(),A._handlePhysics(),d._handleTimer(),J._update(),j._handleTween(),p._draw(),J._lastFrameTimestamp=t,b._resetInput(),window.requestAnimationFrame(J._gameLoop)}static _update(){for(let t=0;t<this._rootNodes.length;t++)null===this._rootNodes[t].parentNode&&this._rootNodes[t].isActive&&this._rootNodes[t]._executeUpdate()}}J._isInitialized=!1,J._rootNodes=[],J._lastFrameTimestamp=-1;const Q=J,Z=class{constructor(t,e,s){this._isStarted=!1,this.tweenStarted=new S,this.tweenEnded=new S,this._duration=t,this._delay=e,this._ease=s,j._registerTween(this)}_start(){this._isStarted=!0,this._startTime=d.timeSinceGameStart(),this.tweenStarted.invoke()}end(){j._unregisterTween(this),this.evaluate(1),this.tweenEnded.invoke(),this._callback&&this._callback()}chain(t){return j._unregisterTween(t),this.tweenEnded.subscribe(t._start),t.tweenStarted.subscribe((()=>j._registerTween(t))),t}},$=class extends Z{constructor(t,e,s,i,n){super(s,i,n),this.evaluate=t,this._retrieveStartValue=e,this._start=this._start.bind(this)}_start(){this._startValue=this._retrieveStartValue(),super._start()}},q=class{constructor(t){this.saturation=70,this.width=100,this.height=100,this.flipX=!1,this.flipY=!1,this.scale=o.ONE,this.offSet=o.ZERO,this.setImage(t)}_draw(){p._canvasContext.scale(this.scale.x*(this.flipX?-1:1),this.scale.y*(this.flipY?-1:1)),p._canvasContext.drawImage(this._image,this.offSet.x-this._image.width/2,this.offSet.y-this._image.height/2)}setImage(t){this._image=new Image,this._image.src=t}tweenSaturation(t,e,s,i,r){const o=new $((e=>{r&&(t+=o._startValue),this.saturation=n.lerpNumber(e,o._startValue,t)}),(()=>this.saturation),e,s,i);return o}};var tt;!function(t){t.POP="https://cdn.pixabay.com/audio/2022/03/15/audio_f746cb8177.mp3",t.CANDY="https://cdn.pixabay.com/audio/2021/08/04/audio_bb630cc098.mp3",t.FLAP="https://cdn.pixabay.com/audio/2021/08/04/audio_ab57d87e23.mp3",t.DEAD="https://cdn.pixabay.com/audio/2022/03/15/audio_9b5d6b8f1e.mp3\n"}(tt||(tt={}));const et=tt;var st;!function(t){t.BIRD_DEFAULT_JUMP="assets/Default_Jump.png",t.BIRD_DEFAULT_GLIDE="assets/Default_Glide.png",t.BIRD_ANGRY_JUMP="assets/Angy_Jump.png",t.BIRD_ANGRY_GLIDE="assets/Angy_Glide.png",t.BIRD_PINKY_JUMP="assets/Pinky_Jump.png",t.BIRD_PINKY_GLIDE="assets/Pinky_Glide.png",t.BIRD_ROUND_JUMP="assets/Round_Jump.png",t.BIRD_ROUND_GLIDE="assets/Round_Glide.png",t.BIRD_ZOMBIE_JUMP="assets/Zombie_Jump.png",t.BIRD_ZOMBIE_GLIDE="assets/Zombie_Glide.png",t.BIRD_DEAD="assets/Dead.png",t.CANDY="assets/Candy.png",t.PAUSE="assets/Pause.png",t.PLAY="assets/Play.png"}(st||(st={}));const it=st;var nt;!function(t){t.BUTTON="assets/Button.png",t.BUTTON_IDLE="assets/Button_Idle.png",t.BUTTON_HOVERED="assets/Button_Hovered.png",t.BUTTON_PRESSED="assets/Button_Pressed.png"}(nt||(nt={}));const rt=nt,ot=class extends q{_draw(){const t=this._image.width/3,e=[0,0,t,t],s=[t,0,t,t],i=[2*t,0,t,t],n=[0,t,t,t],r=[t,t,t,t],o=[2*t,t,t,t],a=[0,2*t,t,t],h=[t,2*t,t,t],l=[2*t,2*t,t,t],c=this.width,u=this.height;p._canvasContext.drawImage(this._image,...e,-c/2,-u/2,t,t),p._canvasContext.drawImage(this._image,...i,c-t-c/2,-u/2,t,t),p._canvasContext.drawImage(this._image,...a,-c/2,u-t-u/2,t,t),p._canvasContext.drawImage(this._image,...l,c-t-c/2,u-t-u/2,t,t),p._canvasContext.drawImage(this._image,...s,t-c/2-1,-u/2,c-2*t+2,t),p._canvasContext.drawImage(this._image,...h,t-c/2-1,u-t-u/2,c-2*t+2,t),p._canvasContext.drawImage(this._image,...n,-c/2,t-u/2-1,t,u-2*t+2),p._canvasContext.drawImage(this._image,...o,c-t-c/2,t-u/2-1,t,u-2*t+2),p._canvasContext.drawImage(this._image,...r,t-c/2-1,t-u/2-1,c-2*t+2,u-2*t+2)}};class at{static _init(){Object.values(it).forEach(((t,e)=>{const s=new q(t);at._sprites.set(t,s)})),Object.values(rt).forEach(((t,e)=>{const s=new ot(t);at._nineSlices.set(t,s)})),Object.values(et).forEach(((t,e)=>{const s=new Audio(t);s.volume=ct.globalVolume,at._sounds.set(t,s)}))}static getSprite(t){return at._sprites.get(t)}static getNineSlice(t){return at._nineSlices.get(t)}static getSoundClip(t){return at._sounds.get(t)}}at._sprites=new Map,at._nineSlices=new Map,at._sounds=new Map;const ht=at;class lt{static _init(t){this.globalVolume=t}static playOnce(t){const e=new Audio(t);e.loop=!1,e.play()}static playLoop(t){const e=ht._sounds.get(t);e.loop=!0,e.play()}static pause(t){ht._sounds.get(t).pause()}static end(t){const e=ht._sounds.get(t);e.loop=!1,e.pause(),e.currentTime=0}static getClipVolume(t){return ht._sounds.get(t).volume}static setClipVolume(t,e){ht._sounds.get(t).volume=e,lt.globalVolume=-1}static setGlobalVolume(t){ht._sounds.forEach(((e,s)=>{e.volume=t})),lt.globalVolume=t}static setMaxVolume(){lt.setGlobalVolume(1)}static mute(){lt.setGlobalVolume(0)}}lt.globalVolume=1;const ct=lt,ut=class extends t{constructor(t){super(),this.game=t}buildDebug(t){c._init(t.isDebugging,t.showFps)}buildTime(){d._init()}buildCanvas(t){const e=document.getElementById("game"),s=document.createElement("canvas");s.id="canvas",s.width=t.canvasSize.x,s.height=t.canvasSize.y,null==e||e.appendChild(s);const i=s.getContext("2d");i?(p.backgroundColor=t.canvasColor,p._init(i,t.canvasSize)):c.logError("Canvas context not found.")}buildInput(t){b._init(t)}buildSound(t){ct._init(t.globalVolume)}buildSystem(){Q._init()}loadResource(){ht._init()}};class dt{}var _t;!function(t){t[t.MOUSE=0]="MOUSE",t[t.KEYBOARD=1]="KEYBOARD",t[t.TOUCH=2]="TOUCH"}(_t||(_t={}));var gt;!function(t){t[t.INIT=0]="INIT",t[t.WELCOME=1]="WELCOME",t[t.PLAY=2]="PLAY",t[t.PAUSE=3]="PAUSE",t[t.RESULT=4]="RESULT",t[t.SHOP=5]="SHOP"}(gt||(gt={}));const mt=gt,pt=class{},wt=class extends R{constructor(t){super(t),this.type=T.TRANSFORM,this._componentRequirements=[],this.rotation=0,this.scale=o.ONE,this._localPosition=o.ZERO}get localPosition(){return this._localPosition}set localPosition(t){this._localPosition=t}get globalPosition(){const t=this._localToWorldMatrix();return new o(t.values[0][2],t.values[1][2])}set globalPosition(t){this._localPosition=this._localToWorldMatrix(!0).inverse().multiplyVector(t)}_localToWorldMatrix(t=!1){const e=h.translate(this._localPosition.x,this._localPosition.y),s=h.rotate(this.rotation),i=h.scale(this.scale.x,this.scale.y);let n=e.multiplyMatrix(s).multiplyMatrix(i);if(t&&(n=h.IDENTITY),this.owner.parentNode){let t=this.owner.parentNode;for(;t;)t.hasComponent(T.TRANSFORM)&&(n=t.getComponent(T.TRANSFORM)._localToWorldMatrix().multiplyMatrix(n)),t=t.parentNode}return n}tweenPosition(t,e,s,i,r,o=void 0){const a=new $((e=>{r&&t.add(a._startValue),this.globalPosition=n.lerpVector(e,a._startValue,t)}),(()=>this.globalPosition),e,s,i);return o&&(a._callback=o),a}tweenPositionX(t,e,s,i,r,o=void 0){const a=new $((e=>{r&&(t+=a._startValue),this.globalPosition=this.globalPosition.withX(n.lerpNumber(e,a._startValue,t))}),(()=>this.globalPosition.x),e,s,i);return a}tweenPositionY(t,e,s,i,r,o=void 0){const a=new $((e=>{r&&(t+=a._startValue),this.globalPosition=this.globalPosition.withY(n.lerpNumber(e,a._startValue,t))}),(()=>this.globalPosition.y),e,s,i);return o&&(a._callback=o),a}tweenScale(t,e,s,i,r,o=void 0){const a=new $((e=>{r&&t.add(a._startValue),this.scale=n.lerpVector(e,a._startValue,t)}),(()=>this.scale),e,s,i);return o&&(a._callback=o),a}},bt=class extends R{constructor(t){super(t),this.type=T.RENDERER,this._componentRequirements=[T.TRANSFORM],this.drawOrder=0,this._drawLayer=g.DEFAULT,this.ownerTransform=t.getComponent(T.TRANSFORM),p._registerRenderer(this)}get drawLayer(){return this._drawLayer}set drawLayer(t){p._unregisterRenderer(this),this._drawLayer=t,p._registerRenderer(this)}_localToWorldMatrix(){return this.ownerTransform._localToWorldMatrix()}setDrawable(t){this.drawable=t}_draw(t){if(!this.drawable)return;let e=this.owner;for(;e;){if(!e.isVisible)return;e=e.parentNode}this.drawable._draw()}tweenColor(t,e,s,i,r){const o=new $((e=>{r&&t.add(o._startValue),this.drawable.color=n.lerpColor(e,o._startValue,t)}),(()=>this.drawable.color),e,s,i);return o}};class Ct extends bt{constructor(t){super(t),this._componentRequirements=[T.TRANSFORM],this.anchor=Tt.MID_CENTER,this.pivot=Tt.MID_CENTER,this.drawLayer=g.UI}get rect(){const t=this.owner.getComponent(T.TRANSFORM);return new x(t.globalPosition,this.elementSize)}_draw(){if(!this.owner.isVisible||!this.drawable)return;let t=this.owner;for(;t;){if(!t.isVisible)return;t=t.parentNode}let e=o.ZERO;switch(this.pivot){case Tt.TOP_LEFT:e=new o(0,0);break;case Tt.TOP_CENTER:e=new o(-.5,0);break;case Tt.TOP_RIGHT:e=new o(-1,0);break;case Tt.MID_LEFT:e=new o(0,-.5);break;case Tt.MID_CENTER:e=new o(-.5,-.5);break;case Tt.MID_RIGHT:e=new o(-1,-.5);break;case Tt.BOTTOM_LEFT:e=new o(0,-1);break;case Tt.BOTTOM_CENTER:e=new o(-.5,-1);break;case Tt.BOTTOM_RIGHT:e=new o(-1,-1)}this.drawable.offSet=this.elementSize.multiplyComp(e),this.drawable._draw()}}var Tt;!function(t){t[t.TOP_LEFT=0]="TOP_LEFT",t[t.TOP_CENTER=1]="TOP_CENTER",t[t.TOP_RIGHT=2]="TOP_RIGHT",t[t.MID_LEFT=3]="MID_LEFT",t[t.MID_CENTER=4]="MID_CENTER",t[t.MID_RIGHT=5]="MID_RIGHT",t[t.BOTTOM_LEFT=6]="BOTTOM_LEFT",t[t.BOTTOM_CENTER=7]="BOTTOM_CENTER",t[t.BOTTOM_RIGHT=8]="BOTTOM_RIGHT"}(Tt||(Tt={}));const Et=class extends Ct{constructor(t){super(t),this.type=T.BUTTON,this._componentRequirements=[T.TRANSFORM],this._lastFrameHovered=!1,this.clicked=new S,this.hovered=new S,this.unhovered=new S,b.registerMouseInteractable(this)}_checkClick(t){let e=this.owner;for(;e;){if(!e.isActive)return;e=e.parentNode}this.rect.isPointInside(t)&&b.getMouseUp()&&this.clicked.invoke()}_checkHover(t){let e=this.owner;for(;e;){if(!e.isActive)return;e=e.parentNode}this.rect.isPointInside(t)?(this.hovered.invoke(),this._lastFrameHovered=!0):this._lastFrameHovered&&(this._lastFrameHovered=!1,this.unhovered.invoke())}},ft=class extends Ct{constructor(t){super(t),this.type=T.BUTTON,this._componentRequirements=[T.TRANSFORM]}setDrawable(t){super.setDrawable(t);const e=p._canvasContext.measureText(t.text);e.fontBoundingBoxAscent,e.fontBoundingBoxDescent,e.actualBoundingBoxAscent,e.actualBoundingBoxDescent,this.elementSize=o.ZERO}},Rt=class extends R{constructor(t){super(t),this.type=T.RIGIDBODY,this._componentRequirements=[T.TRANSFORM],this.collisionLayer=P.DEFAULT,this.mass=1,this.overrideGravity=void 0,this.isMovable=!0,this.ownerTransform=t.getComponent(T.TRANSFORM),A._registerRigidbody(this),this.lastPosition=this.ownerTransform.globalPosition.copy(),this.acceleration=o.ZERO}_updatePosition(t){const e=this.ownerTransform.globalPosition.subtract(this.lastPosition);this.lastPosition=this.ownerTransform.globalPosition.copy(),this.ownerTransform.globalPosition=this.ownerTransform.globalPosition.add(e).add(this.acceleration.multiply(t*t*A.positionScale*A.positionScale)),this.acceleration=o.ZERO}accelerate(t){this.acceleration=this.acceleration.add(t)}setVelocity(t){this.lastPosition=this.ownerTransform.globalPosition.subtract(t.multiply(d.deltaTime()))}},St=class extends bt{constructor(t){super(t),this.type=T.ANIMATOR,this._componentRequirements=[T.TRANSFORM],this.currentIndex=0}get secondsPerFrame(){return this.frameTime}set secondsPerFrame(t){this.frameTime=t,this.frameCountdown=this.frameTime}get framesPerSecond(){return 1/this.frameTime}set framesPerSecond(t){this.frameTime=1/t,this.frameCountdown=this.frameTime}setSprites(t){this.sprites=t,this.currentIndex=0,this.setDrawable(this._getNextSprite())}_draw(t){super._draw(t),this.frameCountdown>0?this.frameCountdown-=t:(this.setDrawable(this._getNextSprite()),this.frameCountdown=this.frameTime)}_getNextSprite(){const t=this.currentIndex;return this.currentIndex=(this.currentIndex+1)%this.sprites.length,this.sprites[t]}},vt=class extends R{constructor(t){super(t),this.type=T.PARTICLE_EMITTER,this._componentRequirements=[T.TRANSFORM],this._gravity=o.ZERO,this._initialized=!1,this._count=10,this._velocityMagnitude=10}init(t){return c.assert(!this._initialized,"Particle emitter is used before initialization."),this._initialized=!0,this}setCount(t){return this._count=t,this}setVelocityMagnitude(t){return this._velocityMagnitude=t,this}setGravity(t){return this._gravity=t,this}play(){for(let t=0;t<this._count;t++){const t=this._pool.getObject();t.transform.globalPosition=o.ZERO,t.rigidbody.overrideGravity=this._gravity,t.rigidbody.setVelocity(o.RANDOM_UNIT.multiply(this._velocityMagnitude))}}},It=class{constructor(t){this.isActive=!0,this.isVisible=!0,this.parentNode=null,this.childNodes=[],this.components=[],this._guid=f.generate(),this.name=t,Q._registerRootNode(this),this.init()}getGuid(){return this._guid}_setGuid(){this._guid=f.generate()}init(){}start(){}update(){}destroy(){}_executeStart(){this.start();for(let t=0;t<this.childNodes.length;t++)this.childNodes[t]._executeStart()}_executeUpdate(){if(this.isActive){this.update();for(let t=0;t<this.childNodes.length;t++)this.childNodes[t]._executeUpdate()}}hasComponent(t){return-1!==this.components.findIndex(((e,s,i)=>e.type===t))}getComponent(t){const e=this.components.filter((e=>e.type===t));return 0===e.length&&c.logError(`Component of type ${t} not found on actor ${this.name}`),e[0]}addComponent(t){const e=this.components.findIndex((e=>e.type===t));if(-1!==e)return c.logError(`Component of type ${t} already exists on actor ${this.name}.`),this.components[e];let s;switch(t){case T.TRANSFORM:s=new wt(this);break;case T.RENDERER:s=new bt(this);break;case T.RECTANGLE_COLLIDER:s=new O(this);break;case T.CIRCLE_COLLIDER:s=new N(this);break;case T.RIGIDBODY:s=new Rt(this);break;case T.BUTTON:s=new Et(this);break;case T.TEXT:s=new ft(this);break;case T.ANIMATOR:s=new St(this);break;case T.PARTICLE_EMITTER:s=new vt(this)}for(const t of s._componentRequirements)if(-1==this.components.findIndex((e=>e.type==t)))return void c.logError(`Component of type ${s} requires component of type ${t}.`);return this.components.push(s),s}removeComponent(t){}addChild(t){this.childNodes.includes(t)||(this.childNodes.push(t),t.parentNode=this)}removeChild(t){this.childNodes.includes(t)&&(this.childNodes=this.childNodes.filter((e=>e!==t)),t.parentNode=null)}setParent(t){Q._unregisterRootNode(this),t.addChild(this)}removeParent(){null!==this.parentNode&&(this.parentNode.removeChild(this),Q._registerRootNode(this))}},xt=class extends It{constructor(t){super(t),this.spikes=[],this.transform=this.addComponent(T.TRANSFORM),this.collider=this.addComponent(T.RECTANGLE_COLLIDER)}},Ot=class{static getPrimaryColor(t){return t<5?s.GREY:t<10?s.fromHex("1982c4"):t<15?s.fromHex("ff924c"):t<20?s.fromHex("8ac926"):t<25?s.fromHex("ff595e"):t<30?s.fromHex("ffca3a"):s.fromHex("6a4c93")}static getSecondaryColor(t){return t<5?s.WHITE:t<10?s.fromHex("d3eefc"):t<15?s.fromHex("ffe7e5"):t<20?s.fromHex("e2f0cb"):t<25?s.fromHex("ff9aa2"):t<30?s.fromHex("fcf6bd"):s.fromHex("c7ceea")}},Nt=class extends It{init(){this.transform=this.addComponent(T.TRANSFORM),this.collider=this.addComponent(T.RECTANGLE_COLLIDER),this.collider.size=new o(50,40),this.triangle=new class{constructor(t){this.color=t}_draw(){p._canvasContext.fillStyle=this.color.toString(),p._canvasContext.beginPath();for(let t=0;t<this._points.length;t++)p._canvasContext.lineTo(this._points[t].x,this._points[t].y);p._canvasContext.fill()}setPoints(t){this._points=t}}(s.GREY),this.triangle.setPoints([new o(25,0),new o(0,25),new o(-25,0),new o(0,-25)]),this.renderer=this.addComponent(T.RENDERER),this.renderer.setDrawable(this.triangle),this.renderer.drawOrder=100,oe.scoreChanged.subscribe(this.scoreChangedHandler.bind(this))}start(){this.showingPosX=200*n.sign(this.transform.globalPosition.x),this.hidingPosX=250*n.sign(this.transform.globalPosition.x)}show(){this.collider.isActive=!0,this.transform.tweenPositionX(this.showingPosX,.15,0,L.LINEAR,!1)}hide(){this.collider.isActive=!1,this.transform.tweenPositionX(this.hidingPosX,.15,0,L.LINEAR,!1)}scoreChangedHandler(t){this.renderer.tweenColor(Ot.getPrimaryColor(t),.3,0,L.OUT_CUBIC,!1)}},yt=class{constructor(t,e){this.color=e,this.size=t,this.offSet=new o(-this.size.x/2,-this.size.y/2)}_draw(){p._canvasContext.fillStyle=this.color.toString(),p._canvasContext.fillRect(this.offSet.x,this.offSet.y,this.size.x,this.size.y)}},Pt=class extends xt{constructor(t){super(t),this.collider.size=new o(400,100),this.renderer=this.addComponent(T.RENDERER),this.renderer.drawOrder=100,this.rectangle=new yt(new o(400,300),s.GREY),this.renderer.setDrawable(this.rectangle),this.renderer.drawLayer=g.UI,this.renderer.drawOrder=500,oe.scoreChanged.subscribe(this.scoreChangedHandler.bind(this)),oe.stateMachine.configure(mt.RESULT).onEntry(this.getGuid(),(()=>{this.transform.tweenPositionY(.375*this.startYPos,.5,.7,L.OUT_CUBIC,!1)})),oe.stateMachine.configure(mt.WELCOME).onEntry(this.getGuid(),(()=>{this.transform.tweenPositionY(this.startYPos,.5,.5,L.OUT_CUBIC,!1)}))}start(){for(let t=-200;t<=200;t+=50){const e=new Nt("Spike");e.setParent(this);const s=t,i=250*n.sign(this.transform.globalPosition.y);e.transform.globalPosition=new o(s,i),e.renderer.drawLayer=g.UI,e.renderer.drawOrder=500,e.start(),this.spikes.push(e)}this.startYPos=this.transform.globalPosition.y}scoreChangedHandler(t){this.renderer.tweenColor(Ot.getPrimaryColor(t),.3,0,L.OUT_CUBIC,!1)}},Mt=class extends It{constructor(t){super(t),this.transform=this.addComponent(T.TRANSFORM),this.rectangle=new yt(p.canvasSize,s.WHITE),this.renderer=this.addComponent(T.RENDERER),this.renderer.setDrawable(this.rectangle),this.renderer.drawOrder=-100,oe.scoreChanged.subscribe(this.scoreChangedHandler.bind(this))}scoreChangedHandler(t){this.renderer.tweenColor(Ot.getSecondaryColor(t),.3,0,L.OUT_CUBIC,!1)}},At=class{constructor(t,e=s.BLACK){this.lineHeight=0,this.text=t,this.color=e}_draw(){p._canvasContext.font=this.font,p._canvasContext.textAlign="center",p._canvasContext.textBaseline="middle",p._canvasContext.fillStyle=this.color.toString();const t=this.text.split("\n");for(let e=0;e<t.length;e++)p._canvasContext.fillText(t[e],this.offSet.x,this.offSet.y-this.lineHeight*((t.length-1)/2-e));const e=p._canvasContext.measureText(this.text),s=(e.fontBoundingBoxAscent,e.fontBoundingBoxDescent,e.actualBoundingBoxAscent+e.actualBoundingBoxDescent);new o(e.width,s)}};class Dt extends It{constructor(t){super(t),this.transform=this.addComponent(T.TRANSFORM),this.textContent=new At("DON'T TOUCH",s.GREY),this.textContent.font="60px tahoma",this.text=this.addComponent(T.TEXT),this.text.setDrawable(this.textContent),this.text.pivot=Tt.MID_CENTER,this.text.drawOrder=200,oe.stateMachine.configure(mt.WELCOME).onEntry(this.getGuid(),(()=>{this.transform.globalPosition=new o(0,150),this.isVisible=!0,this.isActive=!0})),oe.stateMachine.configure(mt.WELCOME).onExit(this.getGuid(),(()=>{this.transform.tweenPositionY(500,.5,0,L.OUT_CUBIC,!1,(()=>{this.isVisible=!1,this.isActive=!1}))}))}}class Lt extends It{constructor(t){super(t),this.transform=this.addComponent(T.TRANSFORM),this.transform.globalPosition=new o(0,80),this.textContent=new At("THE SPIKE",s.GREY),this.textContent.font="60px tahoma",this.text=this.addComponent(T.TEXT),this.text.setDrawable(this.textContent),this.text.pivot=Tt.MID_CENTER,this.text.drawOrder=200,oe.stateMachine.configure(mt.WELCOME).onEntry(this.getGuid(),(()=>{this.isVisible=!0,this.isActive=!0})),oe.stateMachine.configure(mt.WELCOME).onExit(this.getGuid(),(()=>{this.isVisible=!1,this.isActive=!1}))}}const Ut=class{constructor(t,e){this.color=e,this.size=t}_draw(){p._canvasContext.fillStyle=this.color.toString(),p._canvasContext.beginPath(),p._canvasContext.arc(0,0,this.size,0,2*Math.PI),p._canvasContext.fill()}},kt=class extends It{constructor(t,e,i){super(t),this.transform=this.addComponent(T.TRANSFORM),this.transform.tweenScale(o.ONE.multiply(.2),.2,0,L.IN_EXPO,!1),this.transform.globalPosition=new o(e.x,e.y);const n=new Ut(8,i);this.renderer=this.addComponent(T.RENDERER),this.renderer.setDrawable(n),this.renderer.drawOrder=0,this.renderer.tweenColor(s.CLEAR,.2,0,L.IN_EXPO,!1)}},Bt=class extends It{constructor(){super(...arguments),this.isAlive=!0,this.lastJumpTime=0,this.isMovingRight=!0,this.moveSpeed=235,this.jumpCurveXCoeff=2.6,this.jumpCurveYCoeff=100,this.jumpSpriteTimeout=.4,this.jumpSpriteTimer=.4,this.trailDotSpawnTimeout=.07,this.trailDotSpawnTimer=.07,this.trailDotEffectiveTime=.4}init(){this.transform=this.addComponent(T.TRANSFORM),this.transform.globalPosition=new o(0,0),this.lastJumpTime=d.timeSinceGameStart(),this.lastJumpPosY=this.transform.globalPosition.y,this.collider=this.addComponent(T.RECTANGLE_COLLIDER),this.collider.size=new o(20,20),this.collider.collisionStarted.subscribe(this.handleCollisionStart.bind(this)),this.renderer=this.addComponent(T.RENDERER),this.renderer.drawOrder=5,this.particleEmitter=this.addComponent(T.PARTICLE_EMITTER),this.touchedLeftWall=new S,this.touchedRightWall=new S,this.touchedLeftWall.subscribe(this.turnRight.bind(this)),this.touchedRightWall.subscribe(this.turnLeft.bind(this)),this.touchedLeftWall.subscribe(this.wallTouchedHandler.bind(this)),this.touchedRightWall.subscribe(this.wallTouchedHandler.bind(this)),this.touchedLeftWall.subscribe((()=>this.scoreChanged.invoke(oe.currentScore))),this.touchedRightWall.subscribe((()=>this.scoreChanged.invoke(oe.currentScore))),this.jumpSprite=ht.getSprite(it.BIRD_ROUND_JUMP),this.jumpSprite.scale=o.ONE.multiply(.12),this.glideSprite=ht.getSprite(it.BIRD_ROUND_GLIDE),this.glideSprite.scale=o.ONE.multiply(.12),this.deadSprite=ht.getSprite(it.BIRD_DEAD),this.deadSprite.scale=o.ONE.multiply(.12),this.scoreChanged=new v,oe.stateMachine.configure(mt.WELCOME).onEntry(this.getGuid(),(()=>{this.transform.globalPosition=o.ZERO,this.jumpSprite=oe.currentSkin.jumpSprite,this.glideSprite=oe.currentSkin.glideSprite,this.turnRight()})),oe.stateMachine.configure(mt.PLAY).onEntry(this.getGuid(),(()=>{this.collider.isActive=!0,this.isAlive=!0,this.jump()})),oe.stateMachine.configure(mt.PLAY).onExit(this.getGuid(),(()=>{this.collider.isActive=!1})),oe.stateMachine.configure(mt.RESULT).onEntry(this.getGuid(),(()=>{this.isAlive=!1,this.renderer.setDrawable(this.deadSprite),this.deadSprite.flipX=this.isMovingRight})),oe.stateMachine.configure(mt.SHOP).onEntry(this.getGuid(),(()=>{this.isVisible=!1})),oe.stateMachine.configure(mt.SHOP).onExit(this.getGuid(),(()=>{this.isVisible=!0}))}update(){if(oe.stateMachine.currentState===mt.WELCOME)this.playIdleAnimation();else if(oe.stateMachine.currentState===mt.PLAY){this.move(),(b.getKeyDown(" ")||b.getMouseDown())&&this.jump();const t=d.timeSinceGameStart()-this.lastJumpTime;this.transform.globalPosition=this.transform.globalPosition.withY(this.jumpYFunction(t)),this.jumpSpriteTimer-=d.deltaTime(),this.jumpSpriteTimer<0&&this.renderer.setDrawable(this.glideSprite),this.handleSpawnTrailDot()}else oe.stateMachine.currentState,mt.RESULT}turnLeft(){this.isMovingRight=!1,this.jumpSprite.flipX=!1,this.glideSprite.flipX=!1}turnRight(){this.isMovingRight=!0,this.jumpSprite.flipX=!0,this.glideSprite.flipX=!0}move(){this.isMovingRight?this.transform.globalPosition=this.transform.globalPosition.withX(this.transform.globalPosition.x+d.deltaTime()*this.moveSpeed):this.transform.globalPosition=this.transform.globalPosition.withX(this.transform.globalPosition.x-d.deltaTime()*this.moveSpeed)}jump(){this.isAlive&&(this.renderer.setDrawable(this.jumpSprite),this.lastJumpTime=d.timeSinceGameStart(),this.lastJumpPosY=this.transform.globalPosition.y,this.jumpSpriteTimer=this.jumpSpriteTimeout,ct.playOnce(et.FLAP))}jumpYFunction(t){const e=t*this.jumpCurveXCoeff;return(1-Math.pow(e-1,2))*this.jumpCurveYCoeff+this.lastJumpPosY}handleCollisionStart(t){"Wall"===t.owner.name?(this.isMovingRight?this.touchedRightWall.invoke():this.touchedLeftWall.invoke(),ct.playOnce(et.POP)):"Spike"===t.owner.name?(oe.stateMachine.changeState(mt.RESULT),ct.playOnce(et.DEAD)):"Candy"===t.owner.name&&(oe.candyCount++,t.owner.destroy(),ct.playOnce(et.CANDY))}wallTouchedHandler(){this.isAlive&&oe.currentScore++}playIdleAnimation(){Math.round(d.timeSinceGameStart())%2==0?this.renderer.setDrawable(this.glideSprite):this.renderer.setDrawable(this.jumpSprite),this.transform.globalPosition=this.transform.globalPosition.withY(20*Math.sin(d.timeSinceGameStart())-10)}handleSpawnTrailDot(){this.isAlive&&!(d.timeSinceGameStart()-this.lastJumpTime>this.trailDotEffectiveTime)&&(this.trailDotSpawnTimer-=d.deltaTime(),this.trailDotSpawnTimer<0)&&(new kt("Dot",this.transform.globalPosition,oe.currentSkin.trailColor).start(),this.trailDotSpawnTimer=this.trailDotSpawnTimeout)}},Gt=class extends It{init(){this.transform=this.addComponent(T.TRANSFORM),this.collider=this.addComponent(T.RECTANGLE_COLLIDER),this.collider.size=new o(40,40);const t=new q(it.CANDY);t.scale=o.ONE.multiply(.25),this.renderer=this.addComponent(T.RENDERER),this.renderer.setDrawable(t),this.renderer.drawOrder=100,this.transform.scale=o.ZERO,this.transform.tweenScale(o.ONE,.5,0,L.OUT_CUBIC,!1),oe.stateMachine.configure(mt.RESULT).onExit(this.getGuid(),this.destroy.bind(this))}start(){this.initPosY=this.transform.globalPosition.y}update(){this.transform.globalPosition=this.transform.globalPosition.withY(5*Math.sin(d.timeSinceGameStart())),this.transform.rotation=10*Math.sin(1.2*d.timeSinceGameStart())}destroy(){Q._unregisterRootNode(this),A._unregisterCollider(this.collider),this.transform.globalPosition=new o(999,999)}},Ft=class extends xt{constructor(t){super(t),oe.stateMachine.configure(mt.WELCOME).onEntry(this.getGuid(),(()=>{this.hideSpike(),this.showSpike()}))}start(){this.collider.size=new o(100,600);for(let t=-200;t<=200;t+=50){const e=new Nt("Spike");e.setParent(this),e.transform.globalPosition=new o(this.transform.globalPosition.x,t),e.start(),this.spikes.push(e)}}showSpike(){this.collider.isActive=!0;const t=this.difficultyFunction(oe.currentScore),e=n.randomIntBag(0,this.spikes.length,t+1);for(let t=0;t<e.length-1;t++)this.spikes[e[t]].show();if(oe.stateMachine.currentState===mt.PLAY&&Math.random()<.35){const t=this.spikes[e[e.length-1]].transform.globalPosition.y;new Gt("Candy").transform.globalPosition=new o(150*n.sign(this.transform.globalPosition.x),t)}}hideSpike(){this.collider.isActive=!1;for(let t=0;t<this.spikes.length;t++)this.spikes[t].hide()}difficultyFunction(t){return 0==t?0:Math.floor(Math.log(t+2)/Math.log(1.6)*.8)}},zt=class extends It{constructor(t){super(t),this.transform=this.addComponent(T.TRANSFORM);const e=new Ut(100,new s(.1,.1,.1,.15));this.renderer=this.addComponent(T.RENDERER),this.renderer.setDrawable(e),this.renderer.drawOrder=-2,this.isVisible=!1,this.isActive=!1,oe.stateMachine.configure(mt.PLAY).onEntry(this.getGuid(),(()=>{this.isVisible=!0,this.isActive=!0})),oe.stateMachine.configure(mt.RESULT).onExit(this.getGuid(),(()=>{this.isVisible=!1,this.isActive=!1}))}},Vt=class extends It{constructor(t){super(t),this.transform=this.addComponent(T.TRANSFORM),this.textContent=new At("00",new s(1,1,1,.5)),this.textContent.font="100px tahoma",this.text=this.addComponent(T.TEXT),this.text.setDrawable(this.textContent),this.text.pivot=Tt.MID_CENTER,this.text.drawOrder=-1,this.text.drawLayer=g.DEFAULT,this.isVisible=!1,this.isActive=!1,oe.stateMachine.configure(mt.PLAY).onEntry(this.getGuid(),(()=>{this.textContent.text="0",this.isVisible=!0,this.isActive=!0})),oe.stateMachine.configure(mt.RESULT).onExit(this.getGuid(),(()=>{this.isVisible=!1,this.isActive=!1}))}changeScore(t){this.textContent.text=t.toString()}},Yt=class extends It{constructor(t,e,i){super(t),this.idleButtonNineSlice=e,this.hoveredButtonNineSlice=i,this.transform=this.addComponent(T.TRANSFORM),this.button=this.addComponent(T.BUTTON),this.button.pivot=Tt.MID_CENTER,this.button.drawOrder=1e3,this.button.setDrawable(this.idleButtonNineSlice),this.textContent=new At("Text",s.WHITE),this.text=this.addComponent(T.TEXT),this.textContent.font="40px tahoma",this.text.setDrawable(this.textContent),this.text.drawOrder=1001,this.button.hovered.subscribe((()=>{this.button.setDrawable(this.hoveredButtonNineSlice)})),this.button.unhovered.subscribe((()=>{this.button.setDrawable(this.idleButtonNineSlice)}))}setButtonSize(t){this.idleButtonNineSlice.width=this.hoveredButtonNineSlice.width=t.x,this.idleButtonNineSlice.height=this.hoveredButtonNineSlice.height=t.y,this.button.elementSize=t}},Ht=class extends Yt{constructor(t){super(t,new ot(rt.BUTTON_IDLE),new ot(rt.BUTTON_HOVERED)),this.setButtonSize(new o(300,75)),this.button.drawOrder=100,this.text.drawOrder=101,this.isVisible=!1,this.isActive=!1,this.textContent.text="PLAY",this.button.clicked.subscribe(this.changeToPlayState.bind(this)),oe.stateMachine.configure(mt.WELCOME).onEntry(this.getGuid(),(()=>{this.transform.globalPosition=new o(0,-112.5),this.isVisible=!0,this.isActive=!0})),oe.stateMachine.configure(mt.WELCOME).onExit(this.getGuid(),(()=>{this.transform.tweenPositionY(-500,.5,0,L.OUT_CUBIC,!1,(()=>{this.isVisible=!1,this.isActive=!1}))}))}changeToPlayState(){oe.stateMachine.changeState(mt.PLAY)}},Wt=class extends Yt{constructor(t){super(t,new ot(rt.BUTTON_IDLE),new ot(rt.BUTTON_HOVERED)),this.transform.globalPosition=new o(0,-150),this.setButtonSize(new o(300,100)),this.isVisible=!1,this.isActive=!1,this.textContent.text="REPLAY",this.button.clicked.subscribe(this.changeToPlayState.bind(this)),oe.stateMachine.configure(mt.RESULT).onEntry(this.getGuid(),(()=>{this.transform.globalPosition=new o(0,-500),this.transform.tweenPositionY(-200,.5,.7,L.OUT_CUBIC,!1),this.isVisible=!0,this.isActive=!0})),oe.stateMachine.configure(mt.RESULT).onExit(this.getGuid(),(()=>{this.isVisible=!1,this.isActive=!1}))}changeToPlayState(){oe.stateMachine.changeState(mt.WELCOME)}},Xt=class extends It{constructor(){super(...arguments),this.isPausing=!1}init(){this.transform=this.addComponent(T.TRANSFORM),this.transform.globalPosition=new o(-175,275),this.pauseSprite=ht.getSprite(it.PAUSE),this.pauseSprite.scale=o.ONE.multiply(.2),this.playSprite=ht.getSprite(it.PLAY),this.playSprite.scale=o.ONE.multiply(.2),this.button=this.addComponent(T.BUTTON),this.button.elementSize=new o(50,50),this.button.setDrawable(this.pauseSprite),this.button.pivot=Tt.MID_CENTER,this.button.drawLayer=g.UI,this.isVisible=!1,this.isActive=!1,this.button.clicked.subscribe(this.togglePause.bind(this)),oe.stateMachine.configure(mt.PLAY).onEntry(this.getGuid(),(()=>{this.isVisible=!0,this.isActive=!0})),oe.stateMachine.configure(mt.RESULT).onEntry(this.getGuid(),(()=>{this.isVisible=!1,this.isActive=!1})),oe.stateMachine.configure(mt.PAUSE).onEntry(this.getGuid(),(()=>{d.isPaused=!0})),oe.stateMachine.configure(mt.PAUSE).onExit(this.getGuid(),(()=>{d.isPaused=!1}))}togglePause(){this.isPausing=!this.isPausing,this.isPausing?(oe.stateMachine.changeState(mt.PAUSE),this.button.setDrawable(this.playSprite)):(oe.stateMachine.changeState(mt.PLAY),this.button.setDrawable(this.pauseSprite))}};class Kt{constructor(t,e,s){this.state=t,this.guid=e,this.callback=s}}const jt=class extends It{constructor(t){super(t),this.transform=this.addComponent(T.TRANSFORM),this.textContent=new At("Text",s.WHITE),this.text=this.addComponent(T.TEXT),this.textContent.font="40px tahoma",this.text.setDrawable(this.textContent),this.text.drawOrder=1001,this.panel=this.addComponent(T.RENDERER),this.panel.drawLayer=g.UI}},Jt=class extends jt{constructor(t){super(t),this.transform.globalPosition=new o(0,500),this.textContent.font="30px tahoma",this.text.drawOrder=1001,this.textContent.lineHeight=40;const e=new ot(rt.BUTTON_IDLE);e.width=300,e.height=100,this.panel.setDrawable(e),this.panel.drawOrder=1e3,oe.stateMachine.configure(mt.RESULT).onEntry(this.getGuid(),(()=>{this.textContent.text=`SCORE: ${oe.currentScore}\nHIGH SCORE: ${oe.highScore}`,this.transform.tweenPositionY(200,.5,.7,L.OUT_CUBIC,!1)})),oe.stateMachine.configure(mt.RESULT).onExit(this.getGuid(),(()=>{this.transform.tweenPositionY(500,.5,.5,L.OUT_CUBIC,!1)}))}changeScore(t){this.textContent.text=t.toString()}},Qt=class{constructor(t,e,s,i,n,r){this.name=t,this.skinType=e,this.jumpSprite=s,this.glideSprite=i,this.trailColor=n,this.price=r,this.jumpSprite.scale=o.ONE.multiply(.12),this.glideSprite.scale=o.ONE.multiply(.12)}},Zt=class extends It{constructor(t){super(t),this.transform=this.addComponent(T.TRANSFORM),this.renderer=this.addComponent(T.RENDERER)}},$t=class extends It{constructor(t,e){super(t),this.isJumping=!0,this.purchased=!1,this.skinData=e,this.transform=this.addComponent(T.TRANSFORM),this.buttonNode=new Yt("Purchase button",new ot(rt.BUTTON_IDLE),new ot(rt.BUTTON_HOVERED)),this.buttonNode.setButtonSize(new o(100,50)),this.buttonNode.setParent(this),this.buttonNode.transform.localPosition=new o(0,-50),this.buttonNode.textContent.text=e.price.toString(),this.buttonNode.textContent.color=s.WHITE,this.buttonNode.text.drawable.offSet=new o(-500,0),this.buttonNode.button.clicked.subscribe(this.purchase.bind(this)),this.skin=new Zt("Skin"),this.skin.setParent(this),this.skin.renderer.setDrawable(e.jumpSprite),new class{constructor(t,e,s=1,i=1){this.callback=t,this.delay=e,this.repeat=s,this.interval=i,this.delayCountdown=e,this.repeatCountdown=s,this.intervalCountdown=-1,this.guid=f.generate(),d._registerTimer(this)}evaluate(t){0!==this.repeatCountdown?this.delayCountdown>0?this.delayCountdown-=t:this.intervalCountdown>0?this.intervalCountdown-=t:(this.callback(),this.intervalCountdown=this.interval,this.repeatCountdown--):d._unregisterTimer(this)}}((()=>{this.skin.renderer.setDrawable(this.isJumping?e.jumpSprite:e.glideSprite),this.isJumping=!this.isJumping}),0,-1,1),ne.changeSkin.subscribe(this.changeSkinHandler.bind(this))}update(){this.skin.transform.localPosition=this.skin.transform.localPosition.withY(5*Math.sin(d.timeSinceGameStart()))}purchase(){oe.candyCount<this.skinData.price||(this.purchased=!0,oe.candyCount-=this.skinData.price,oe.unlockedSkins.push(this.skinData.skinType),this.buttonNode.button.clicked.unsubscribe(this.purchase),this.buttonNode.button.clicked.subscribe((()=>ne.changeSkin.invoke(this.skinData.skinType))),ne.changeSkin.invoke(this.skinData.skinType))}changeSkinHandler(t){this.purchased&&(t===this.skinData.skinType?(this.buttonNode.textContent.text="ON",oe.currentSkin=this.skinData):this.buttonNode.textContent.text="OFF")}};var qt;!function(t){t[t.DEFAULT=0]="DEFAULT",t[t.ANGRY=1]="ANGRY",t[t.PINKY=2]="PINKY",t[t.ROUNDY=3]="ROUNDY",t[t.ZOMBIE=4]="ZOMBIE"}(qt||(qt={}));const te=qt,ee=class extends Yt{constructor(t){super(t,new ot(rt.BUTTON_IDLE),new ot(rt.BUTTON_HOVERED)),this.transform.globalPosition=new o(0,-187.5),this.setButtonSize(new o(300,50)),this.isVisible=!1,this.isActive=!1,this.textContent.text="SHOP",this.textContent.font="20px tahoma",this.button.drawOrder=100,this.text.drawOrder=101,this.button.clicked.subscribe((()=>oe.stateMachine.changeState(mt.SHOP))),oe.stateMachine.configure(mt.WELCOME).onEntry(this.getGuid(),(()=>{this.transform.globalPosition=new o(0,-187.5),this.isVisible=!0,this.isActive=!0})),oe.stateMachine.configure(mt.WELCOME).onExit(this.getGuid(),(()=>{this.transform.tweenPositionY(-500,.5,0,L.OUT_CUBIC,!1,(()=>{this.isVisible=!1,this.isActive=!1}))}))}},se=class extends It{constructor(t){super(t),this.transform=this.addComponent(T.TRANSFORM),this.transform.globalPosition=new o(125,200),this.textContent=new At("0"),this.text=this.addComponent(T.TEXT),this.text.setDrawable(this.textContent);const e=ht.getSprite(it.CANDY);e.scale=o.ONE.multiply(.25),e.offSet=new o(150,0),this.rendererNode=new Zt("Candy Sprite"),this.rendererNode.renderer.setDrawable(e),this.rendererNode.setParent(this),this.isVisible=!1,oe.stateMachine.configure(mt.SHOP).onEntry(this.getGuid(),(()=>{this.isVisible=!0})),oe.stateMachine.configure(mt.SHOP).onExit(this.getGuid(),(()=>{this.isVisible=!1})),oe.candyCountChanged.subscribe((t=>this.textContent.text=t.toString()))}};class ie extends It{constructor(t){super(t),this.skins=[new Qt("Normie",te.DEFAULT,ht.getSprite(it.BIRD_DEFAULT_JUMP),ht.getSprite(it.BIRD_DEFAULT_GLIDE),s.fromHex("d62945"),0),new Qt("Angry",te.ANGRY,ht.getSprite(it.BIRD_ANGRY_JUMP),ht.getSprite(it.BIRD_ANGRY_GLIDE),s.fromHex("283756"),1),new Qt("Pinky",te.PINKY,ht.getSprite(it.BIRD_PINKY_JUMP),ht.getSprite(it.BIRD_PINKY_GLIDE),s.fromHex("ee4496"),2),new Qt("Roundy",te.ROUNDY,ht.getSprite(it.BIRD_ROUND_JUMP),ht.getSprite(it.BIRD_ROUND_GLIDE),s.fromHex("3b5ba9"),3),new Qt("Zomby",te.ZOMBIE,ht.getSprite(it.BIRD_ZOMBIE_JUMP),ht.getSprite(it.BIRD_ZOMBIE_GLIDE),s.fromHex("09aa4b"),4)],this.shopItems=[];const e=new $t("Default",this.skins[0]);e.transform.globalPosition=new o(0,175),this.shopItems.push(e),this.addChild(e),e.purchase();const i=new $t("Angry",this.skins[1]);i.transform.globalPosition=new o(-100,25),this.shopItems.push(i),this.addChild(i);const n=new $t("Pinky",this.skins[2]);n.transform.globalPosition=new o(100,25),this.shopItems.push(n),this.addChild(n);const r=new $t("Roundy",this.skins[3]);r.transform.globalPosition=new o(-100,-125),this.shopItems.push(r),this.addChild(r);const a=new $t("Zombie",this.skins[4]);a.transform.globalPosition=new o(100,-125),this.shopItems.push(a),this.addChild(a),this.shopItems.forEach((t=>t.isActive=t.isVisible=!1)),oe.currentSkin=this.skins[0];const h=new ee("Shop Button");h.start();const l=new se("Candy Counter");l.start(),l.setParent(this);const c=new Yt("Back Button",new ot(rt.BUTTON_IDLE),new ot(rt.BUTTON_IDLE));c.button.clicked.subscribe((()=>oe.stateMachine.changeState(mt.WELCOME))),c.setButtonSize(new o(70,32)),c.textContent.font="20px verdana",c.textContent.text="Back",c.transform.globalPosition=new o(-160,200),c.start(),c.isVisible=!1,oe.stateMachine.configure(mt.SHOP).onEntry(this.getGuid(),(()=>{this.shopItems.forEach((t=>t.isActive=t.isVisible=!0)),this.isVisible=!0,c.isVisible=!0})),oe.stateMachine.configure(mt.SHOP).onExit(this.getGuid(),(()=>{this.shopItems.forEach((t=>t.isActive=t.isVisible=!1)),this.isVisible=!1,c.isVisible=!1})),oe.stateMachine.configure(mt.WELCOME).onEntry(this.getGuid(),(()=>{h.isVisible=!0})),oe.stateMachine.configure(mt.WELCOME).onExit(this.getGuid(),(()=>{h.isVisible=!1}))}}ie.changeSkin=new v;const ne=ie;class re extends pt{static get currentScore(){return re._currentScore}static set currentScore(t){re._currentScore=t,re.scoreChanged.invoke(t)}static get candyCount(){return this._candyCount}static set candyCount(t){this._candyCount=t,re.candyCountChanged.invoke(t)}static init(){re.stateMachine.configure(mt.WELCOME).onEntry(-1,(()=>re.currentScore=0)),re.stateMachine.configure(mt.RESULT).onEntry(-1,(()=>{re.highScore<re._currentScore&&(re.highScore=re._currentScore)})),new ne("Shop").start(),new Mt("Game Background").start(),new Dt("Title").start(),new Lt("Title").start();const t=new Bt("Main Bird");t.start();const e=new Ft("Wall");e.transform.globalPosition=new o(-250,0),e.start();const s=new Ft("Wall");s.transform.globalPosition=new o(250,0),s.start(),t.touchedLeftWall.subscribe((()=>{e.hideSpike(),s.showSpike()})),t.touchedRightWall.subscribe((()=>{s.hideSpike(),e.showSpike()}));const i=new Pt("Top Wall");i.transform.globalPosition=new o(0,400),i.start();const n=new Pt("Bottom Wall");n.transform.globalPosition=new o(0,-400),n.start(),new zt("Score Background").start();const r=new Vt("Score Text");t.scoreChanged.subscribe(r.changeScore.bind(r)),r.start(),new Ht("Play Button").start(),new Xt("Pause Button").start();const a=new Jt("Result");t.scoreChanged.subscribe(a.changeScore.bind(a)),new Wt("Retry Button").start(),re.stateMachine.changeState(mt.WELCOME)}}re.highScore=0,re.scoreChanged=new v,re.stateMachine=new class{constructor(t){this.onEntryCallbacks=[],this.onExitCallbacks=[],this._currentState=t}get currentState(){return this._currentState}changeState(t){c.log("Changed to state: "+t);for(let t=0;t<this.onExitCallbacks.length;t++)this.onExitCallbacks[t].state===this._currentState&&this.onExitCallbacks[t].callback();for(let e=0;e<this.onEntryCallbacks.length;e++)this.onEntryCallbacks[e].state===t&&this.onEntryCallbacks[e].callback();this._currentState=t}configure(t){return this.configuringState=t,this}onEntry(t,e){return this.onEntryCallbacks.push(new Kt(this.configuringState,t,e)),this}onExit(t,e){return this.onExitCallbacks.push(new Kt(this.configuringState,t,e)),this}removeAllOf(t){this.onEntryCallbacks.filter((e=>e.guid===t)),this.onExitCallbacks.filter((e=>e.guid===t))}}(mt.INIT),re._currentScore=0,re._candyCount=0,re.candyCountChanged=new v,re.unlockedSkins=[te.DEFAULT];const oe=re;new class{constructor(){this.buildGame(),this.initGame()}buildGame(){const t=new ut(this),e=new class{};e.isDebugging=!0,e.showFps=!1,t.buildDebug(e),t.buildTime();const i=new class{};i.canvasSize=new o(400,600),i.canvasColor=new s(.2,.2,.2,1),t.buildCanvas(i);const n=new dt;n.inputOptions=[_t.KEYBOARD,_t.MOUSE],t.buildInput(n);const r=new class{};r.globalVolume=1,t.buildSound(r),t.buildSystem(),t.loadResource()}initGame(){oe.init()}}})();