(()=>{"use strict";const t=class{static assert(t,e){console.assert(t,e)}static log(t){console.log(t)}static logError(t){console.error(t)}};class e{constructor(t=1,e=1,s=1,i=1){this.r=t,this.g=e,this.b=s,this.a=i}static get BLACK(){return new e(0,0,0,0)}static get WHITE(){return new e(1,1,1,1)}static get RED(){return new e(1,0,0,1)}static get GREEN(){return new e(0,1,0,1)}static get BLUE(){return new e(0,0,1,1)}static get YELLOW(){return new e(1,1,0,1)}static get CYAN(){return new e(0,1,1,1)}static get MAGENTA(){return new e(1,0,1,1)}static get GREY(){return new e(.5,.5,.5,1)}static get CLEAR(){return new e(1,1,1,0)}static fromHex(t){t.startsWith("#")&&(t=t.substring(1));const s=parseInt(t,16);return new e((s>>16&255)/255,(s>>8&255)/255,(255&s)/255)}toString(){function t(t){return Math.round(255*t)}return`rgba(${t(this.r)}, ${t(this.g)}, ${t(this.b)}, ${this.a})`}add(t){const s=this.r+t.r,i=this.g+t.g,n=this.b+t.b,r=this.a+t.a,a=Math.max(0,Math.min(1,s)),o=Math.max(0,Math.min(1,i)),h=Math.max(0,Math.min(1,n)),l=Math.max(0,Math.min(1,r));return new e(a,o,h,l)}}const s=e;class i{static clamp(t,e,s){return t<e?e:t>s?s:t}static sign(t){return t>0?1:t<0?-1:0}static randomRange(t,e){return Math.random()*(e-t)+t}static randomRangeInt(t,e){return Math.round(i.randomRange(t,e))+t}static randomIntBag(t,e,s){const i=Array.from({length:e-t},((e,s)=>s+t)),n=[];for(;n.length<s&&i.length>0;){const t=Math.floor(Math.random()*i.length);n.push(i[t]),i.splice(t,1)}return n}static lerpNumber(t,e,s){return(s-e)*t+e}static lerpVector(t,e,s){return s.subtract(e).multiply(t).add(e)}static lerpColor(t,e,n){return new s(i.lerpNumber(t,e.r,n.r),i.lerpNumber(t,e.g,n.g),i.lerpNumber(t,e.b,n.b),i.lerpNumber(t,e.a,n.a))}}i.rad2Deg=180/Math.PI,i.deg2Rad=Math.PI/180;const n=i;class r{constructor(t,e,s=0){this.x=t,this.y=e,this.z=s}static get LEFT(){return new r(-1,0,0)}static get RIGHT(){return new r(1,0,0)}static get UP(){return new r(0,1,0)}static get DOWN(){return new r(0,-1,0)}static get ZERO(){return new r(0,0,0)}static get ONE(){return new r(1,1,1)}static get RANDOM_UNIT(){return new r(n.randomRange(-1,1),n.randomRange(-1,1)).normalized()}static distance(t,e){return t.subtract(e).length()}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}normalized(){const t=this.length();return 0!==t?new r(this.x/t,this.y/t,0):new r(0,0,0)}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}cross(t){const e=this.y*t.z-this.z*t.y,s=this.z*t.x-this.x*t.z,i=this.x*t.y-this.y*t.x;return new r(e,s,i)}angle(t){const e=this.dot(t),s=this.length()*t.length();return Math.acos(e/s)*(180/Math.PI)}add(t){return new r(this.x+t.x,this.y+t.y,this.z+t.z)}subtract(t){return new r(this.x-t.x,this.y-t.y,this.z-t.z)}multiply(t){return new r(this.x*t,this.y*t,this.z*t)}multiplyComp(t){return new r(this.x*t.x,this.y*t.y,this.z*t.z)}xx(){return new r(this.x,this.x,this.z)}yy(){return new r(this.y,this.y,this.z)}xy(){return new r(this.x,this.y,this.z)}yx(){return new r(this.y,this.x,this.z)}}const a=r;class o{constructor(t=0,e=0,s=0,i=0,n=0,r=0,a=0,o=0,h=0){this.values=[],this.values=[[t,e,s],[i,n,r],[a,o,h]]}static get ZERO(){return new o(0,0,0,0,0,0,0,0,0)}static get IDENTITY(){return new o(1,0,0,0,1,0,0,0,1)}static translate(t,e){const s=o.IDENTITY;return s.values[0][2]=t,s.values[1][2]=e,s}static rotate(t){const e=o.IDENTITY,s=Math.cos(t*n.deg2Rad),i=Math.sin(t*n.deg2Rad);return e.values[0][0]=s,e.values[0][1]=-i,e.values[1][0]=i,e.values[1][1]=s,e}static scale(t,e){const s=o.IDENTITY;return s.values[0][0]=t,s.values[1][1]=e,s}determinant(){const t=this.values[0][0],e=this.values[0][1],s=this.values[0][2],i=this.values[1][0],n=this.values[1][1],r=this.values[1][2],a=this.values[2][0],o=this.values[2][1],h=this.values[2][2];return t*(n*h-r*o)-e*(i*h-r*a)+s*(i*o-n*a)}inverse(){const t=this.determinant();if(0===t)throw new Error("Matrix is not invertible.");const e=new o,s=1/t;return e.values[0][0]=(this.values[1][1]*this.values[2][2]-this.values[1][2]*this.values[2][1])*s,e.values[0][1]=(this.values[0][2]*this.values[2][1]-this.values[0][1]*this.values[2][2])*s,e.values[0][2]=(this.values[0][1]*this.values[1][2]-this.values[0][2]*this.values[1][1])*s,e.values[1][0]=(this.values[1][2]*this.values[2][0]-this.values[1][0]*this.values[2][2])*s,e.values[1][1]=(this.values[0][0]*this.values[2][2]-this.values[0][2]*this.values[2][0])*s,e.values[1][2]=(this.values[0][2]*this.values[1][0]-this.values[0][0]*this.values[1][2])*s,e.values[2][0]=(this.values[1][0]*this.values[2][1]-this.values[1][1]*this.values[2][0])*s,e.values[2][1]=(this.values[0][1]*this.values[2][0]-this.values[0][0]*this.values[2][1])*s,e.values[2][2]=(this.values[0][0]*this.values[1][1]-this.values[0][1]*this.values[1][0])*s,e}transpose(){const t=new o;for(let e=0;e<3;e++)for(let s=0;s<3;s++)t.values[e][s]=this.values[s][e];return t}multiplyMatrix(t){const e=new o,s=this.values,i=t.values,n=e.values,r=s[0][0],a=s[0][1],h=s[0][2],l=s[1][0],c=s[1][1],d=s[1][2],u=s[2][0],_=s[2][1],m=s[2][2],C=i[0][0],p=i[0][1],T=i[0][2],g=i[1][0],w=i[1][1],f=i[1][2],E=i[2][0],S=i[2][1],v=i[2][2];return n[0][0]=r*C+a*g+h*E,n[0][1]=r*p+a*w+h*S,n[0][2]=r*T+a*f+h*v,n[1][0]=l*C+c*g+d*E,n[1][1]=l*p+c*w+d*S,n[1][2]=l*T+c*f+d*v,n[2][0]=u*C+_*g+m*E,n[2][1]=u*p+_*w+m*S,n[2][2]=u*T+_*f+m*v,e}matrixMultiplyComponentWise(t){const e=new o;for(let s=0;s<3;s++)for(let i=0;i<3;i++)e.values[s][i]=this.values[s][i]*t.values[s][i];return e}multiplyVector(t){return new a(this.values[0][0]*t.x+this.values[0][1]*t.y+this.values[0][2]*t.z,this.values[1][0]*t.x+this.values[1][1]*t.y+this.values[1][2]*t.z,this.values[2][0]*t.x+this.values[2][1]*t.y+this.values[2][2]*t.z)}}const h=o;class l{static _init(t){l._canvasContext=t;const e=h.translate(l.canvasSize.x/2,l.canvasSize.y/2),s=h.scale(1,-1);this._worldToCameraMatrix=e.multiplyMatrix(s)}static _draw(){l._canvasContext.clearRect(0,0,l.canvasSize.x,l.canvasSize.y),l._canvasContext.fillStyle=l.backgroundColor.toString(),l._canvasContext.fillRect(0,0,l.canvasSize.x,l.canvasSize.y),this._renderers=this._renderers.sort(((t,e)=>t.drawOrder>e.drawOrder?1:-1));for(const t of this._renderers){const e=t._localToWorldMatrix().multiplyMatrix(h.scale(1,-1)),s=l._worldToCameraMatrix.multiplyMatrix(e);l._canvasContext.setTransform(s.values[0][0],s.values[1][0],s.values[0][1],s.values[1][1],s.values[0][2],s.values[1][2]),t._draw(),l._canvasContext.resetTransform()}}static _registerRenderer(t){this._renderers.push(t)}}l.canvasSize=new a(400,600),l.backgroundColor=s.WHITE,l._renderers=[];const c=l;class d{static _init(){document.addEventListener("mousedown",(t=>{d._isMouseClickedLastFrame=!0}),!1),document.addEventListener("keyup",(t=>{d._lastKeyUpKey=t.key}),!1),document.addEventListener("keydown",(t=>{d._lastKeyDownKey=t.key}),!1),document.onmousemove=t=>{t&&(d._lastMousePosition=new a(t.clientX,t.clientY,1))}}static _handleInput(){for(let t=0;t<this._mouseInteractables.length;t++)this._mouseInteractables[t].owner.isActive&&(this._mouseInteractables[t]._click(d.getMousePosition()),this._mouseInteractables[t]._hover(d.getMousePosition()))}static _resetInput(){d._isMouseClickedLastFrame=!1,d._lastKeyUpKey="",d._lastKeyDownKey=""}static registerMouseInteractable(t){this._mouseInteractables.push(t)}static getKeyDown(t){return d._lastKeyDownKey==t}static getKeyUp(t){return d._lastKeyUpKey==t}static getMouseDown(){return d._isMouseClickedLastFrame}static getMousePosition(){return this._lastMousePosition?c._worldToCameraMatrix.inverse().multiplyVector(this._lastMousePosition):a.ZERO}}d._mouseInteractables=[],d._isMouseClickedLastFrame=!1;const u=d;var _;!function(t){t[t.TRANSFORM=0]="TRANSFORM",t[t.RENDERER=1]="RENDERER",t[t.RECTANGLE_COLLIDER=2]="RECTANGLE_COLLIDER",t[t.CIRCLE_COLLIDER=3]="CIRCLE_COLLIDER",t[t.BUTTON=4]="BUTTON",t[t.TEXT=5]="TEXT"}(_||(_={}));const m=_,C=class{constructor(t){this.isActive=!0,this._componentRequirements=[],this.owner=t}};class p{constructor(){this._eventCallbacks=[]}subscribe(t){this._eventCallbacks.push(t)}unsubscribe(){}invoke(){for(const t of this._eventCallbacks)t()}}class T{constructor(){this._eventCallbacks=[]}subscribe(t){this._eventCallbacks.push(t)}unsubscribe(){}invoke(t){for(const e of this._eventCallbacks)e(t)}}const g=class extends C{constructor(t){super(t),this._componentRequirements=[m.TRANSFORM],this.collisionStarted=new T,this.collisionHappening=new T,this.collisionEnded=new T,this._currentFrameCollidingColliders=[],this._lastFrameCollidingColliders=[],v._registerCollider(this),this._ownerTransform=t.getComponent(m.TRANSFORM)}_getWorldPosition(){return this._ownerTransform.position.add(this.offset)}_addCollidingCollider(t){this._currentFrameCollidingColliders.push(t),-1===this._lastFrameCollidingColliders.findIndex((e=>e===t))?this.collisionStarted.invoke(t):this.collisionHappening.invoke(t)}_confirmCollidingColliders(){for(const t of this._lastFrameCollidingColliders)-1===this._currentFrameCollidingColliders.findIndex((e=>e===t))&&this.collisionEnded.invoke(t);this._lastFrameCollidingColliders=this._currentFrameCollidingColliders}},w=class{constructor(t,e){this.center=t,this.size=e}isPointInside(t){return t.x>=this.center.x-this.size.x/2&&t.x<=this.center.x+this.size.x/2&&t.y>=this.center.y-this.size.y/2&&t.y<=this.center.y+this.size.y/2}},f=class extends g{constructor(t,e=a.ONE,s=a.ZERO){super(t),this.type=m.RECTANGLE_COLLIDER,this.size=e,this.offset=s}AABB(){const t=this._ownerTransform.position;return new w(t.add(this.offset),this.size)}},E=class extends g{constructor(t,e=1,s=a.ZERO){super(t),this.type=m.RECTANGLE_COLLIDER,this.size=e,this.offset=s}AABB(){const t=this._ownerTransform.position;return new w(t.add(this.offset),a.ONE.multiply(2))}};class S{static _registerCollider(t){this._colliders.push(t)}static _handlePhysics(){for(let t=0;t<this._colliders.length;t++)for(let e=t+1;e<this._colliders.length;e++)if(this._colliders[t].isActive&&this._colliders[t].owner.isActive&&this._colliders[e].isActive&&this._colliders[e].owner.isActive)if(this._colliders[t]instanceof f){const s=this._colliders[t];if(this._colliders[e]instanceof f){const t=this._colliders[e],i=s._getWorldPosition(),n=t._getWorldPosition(),r=s.size,a=t.size;Math.abs(i.subtract(n).x)<r.x/2+a.x/2&&Math.abs(i.subtract(n).y)<r.y/2+a.y/2&&S._broadcastCollision(s,t)}else this._colliders[e]instanceof E&&this._colliders[e]}else if(this._colliders[t]instanceof E){const s=this._colliders[t];if(this._colliders[e]instanceof f)this._colliders[e];else if(this._colliders[e]instanceof E){const t=this._colliders[e],i=s._getWorldPosition(),n=t._getWorldPosition(),r=s.size,o=t.size;a.distance(i,n)>r+o&&S._broadcastCollision(s,t)}}}static _broadcastCollision(t,e){t._addCollidingCollider(e),e._addCollidingCollider(t)}}S._colliders=[];const v=S;class x{static _init(){x._startTime=Date.now()}static time(){return Date.now()/1e3}static timeSinceGameStart(){return(Date.now()-x._startTime)/1e3}static deltaTime(){return(Date.now()-x._lastFrameTime)/1e3}}const R=x;var b;!function(t){t[t.LINEAR=0]="LINEAR",t[t.IN_SINE=1]="IN_SINE",t[t.OUT_SINE=2]="OUT_SINE",t[t.IN_OUT_SINE=3]="IN_OUT_SINE",t[t.IN_CUBIC=4]="IN_CUBIC",t[t.OUT_CUBIC=5]="OUT_CUBIC",t[t.IN_OUT_CUBIC=6]="IN_OUT_CUBIC",t[t.IN_QUINT=7]="IN_QUINT",t[t.OUT_QUINT=8]="OUT_QUINT",t[t.IN_OUT_QUINT=9]="IN_OUT_QUINT",t[t.IN_CIRC=10]="IN_CIRC",t[t.OUT_CIRC=11]="OUT_CIRC",t[t.IN_OUT_CIRC=12]="IN_OUT_CIRC",t[t.IN_ELASTIC=13]="IN_ELASTIC",t[t.OUT_ELASTIC=14]="OUT_ELASTIC",t[t.IN_OUT_ELASTIC=15]="IN_OUT_ELASTIC",t[t.IN_QUAD=16]="IN_QUAD",t[t.OUT_QUAD=17]="OUT_QUAD",t[t.IN_OUT_QUAD=18]="IN_OUT_QUAD",t[t.IN_QUART=19]="IN_QUART",t[t.OUT_QUART=20]="OUT_QUART",t[t.IN_OUT_QUART=21]="IN_OUT_QUART",t[t.IN_EXPO=22]="IN_EXPO",t[t.OUT_EXPO=23]="OUT_EXPO",t[t.IN_OUT_EXPO=24]="IN_OUT_EXPO",t[t.IN_BACK=25]="IN_BACK",t[t.OUT_BACK=26]="OUT_BACK",t[t.IN_OUT_BACK=27]="IN_OUT_BACK"}(b||(b={}));const I=b,N=Math.pow,O=Math.sqrt,A=Math.sin,y=Math.cos,M=Math.PI,U=1.70158,L=1.525*U,D=U+1,P=2*M/3,k=2*M/4.5,H={[I.LINEAR]:t=>t,[I.IN_QUAD]:function(t){return t*t},[I.OUT_QUAD]:function(t){return 1-(1-t)*(1-t)},[I.IN_OUT_QUAD]:function(t){return t<.5?2*t*t:1-N(-2*t+2,2)/2},[I.IN_CUBIC]:function(t){return t*t*t},[I.OUT_CUBIC]:function(t){return 1-N(1-t,3)},[I.IN_OUT_CUBIC]:function(t){return t<.5?4*t*t*t:1-N(-2*t+2,3)/2},[I.IN_QUART]:function(t){return t*t*t*t},[I.OUT_QUART]:function(t){return 1-N(1-t,4)},[I.IN_OUT_QUART]:function(t){return t<.5?8*t*t*t*t:1-N(-2*t+2,4)/2},[I.IN_QUINT]:function(t){return t*t*t*t*t},[I.OUT_QUINT]:function(t){return 1-N(1-t,5)},[I.IN_OUT_QUINT]:function(t){return t<.5?16*t*t*t*t*t:1-N(-2*t+2,5)/2},[I.IN_SINE]:function(t){return 1-y(t*M/2)},[I.OUT_SINE]:function(t){return A(t*M/2)},[I.IN_OUT_SINE]:function(t){return-(y(M*t)-1)/2},[I.IN_EXPO]:function(t){return 0===t?0:N(2,10*t-10)},[I.OUT_EXPO]:function(t){return 1===t?1:1-N(2,-10*t)},[I.IN_OUT_EXPO]:function(t){return 0===t?0:1===t?1:t<.5?N(2,20*t-10)/2:(2-N(2,-20*t+10))/2},[I.IN_CIRC]:function(t){return 1-O(1-N(t,2))},[I.OUT_CIRC]:function(t){return O(1-N(t-1,2))},[I.IN_OUT_CIRC]:function(t){return t<.5?(1-O(1-N(2*t,2)))/2:(O(1-N(-2*t+2,2))+1)/2},[I.IN_BACK]:function(t){return D*t*t*t-U*t*t},[I.OUT_BACK]:function(t){return 1+D*N(t-1,3)+U*N(t-1,2)},[I.IN_OUT_BACK]:function(t){return t<.5?N(2*t,2)*(7.189819*t-L)/2:(N(2*t-2,2)*((L+1)*(2*t-2)+L)+2)/2},[I.IN_ELASTIC]:function(t){return 0===t?0:1===t?1:-N(2,10*t-10)*A((10*t-10.75)*P)},[I.OUT_ELASTIC]:function(t){return 0===t?0:1===t?1:N(2,-10*t)*A((10*t-.75)*P)+1},[I.IN_OUT_ELASTIC]:function(t){return 0===t?0:1===t?1:t<.5?-N(2,20*t-10)*A((20*t-11.125)*k)/2:N(2,-20*t+10)*A((20*t-11.125)*k)/2+1}};class B{static _registerTween(t){this._tweens.push(t)}static _unregisterTween(t){B._tweens=B._tweens.filter((e=>e!=t))}static _handleTween(){const t=[];for(const e of B._tweens){if(e._isStarted||e._start(),e._startTime+e._delay<R.timeSinceGameStart()){const t=(R.timeSinceGameStart()-e._startTime)/e._duration,s=H[e._ease](t);e.evaluate(s)}e._startTime+e._duration<R.timeSinceGameStart()&&(t.push(e),e.end())}B._tweens=B._tweens.filter((e=>!t.includes(e)))}}B._tweens=[];const z=B;class F{static init(e){t.assert(!F._isInitialized,"Game is already initialized."),R._init(),u._init(),c._init(e),F._lastFrameTimestamp=Date.now(),window.requestAnimationFrame(F._gameLoop)}static _registerNode(t){F._nodes.push(t)}static _unregisterNode(t){F._nodes=F._nodes.filter((t=>t!=t))}static _gameLoop(){const t=Date.now();R._lastFrameTime=F._lastFrameTimestamp,u._handleInput(),v._handlePhysics(),F._update(),z._handleTween(),c._draw(),F._lastFrameTimestamp=t,u._resetInput(),window.requestAnimationFrame(F._gameLoop)}static _update(){for(let t=0;t<this._nodes.length;t++)null===this._nodes[t].parentNode&&this._nodes[t].isActive&&this._nodes[t]._executeUpdate()}}F._isInitialized=!1,F._nodes=[],F._lastFrameTimestamp=-1;const W=F,G=class{constructor(t,e,s){this._isStarted=!1,this.tweenStarted=new p,this.tweenEnded=new p,this._duration=t,this._delay=e,this._ease=s,z._registerTween(this)}_start(){this._isStarted=!0,this._startTime=R.timeSinceGameStart(),this.tweenStarted.invoke()}end(){z._unregisterTween(this),this.evaluate(1),this.tweenEnded.invoke()}chain(t){return z._unregisterTween(t),this.tweenEnded.subscribe(t._start),t.tweenStarted.subscribe((()=>z._registerTween(t))),t}},V=class extends G{constructor(t,e,s,i,n){super(s,i,n),this.evaluate=t,this._retrieveStartValue=e,this._start=this._start.bind(this)}_start(){this._startValue=this._retrieveStartValue(),super._start()}},X=class extends C{constructor(t,e=a.ZERO,s=0,i=a.ONE){super(t),this.type=m.TRANSFORM,this._componentRequirements=[],this.position=e,this.rotation=s,this.scale=i}_localToWorldMatrix(){const t=h.translate(this.position.x,this.position.y),e=h.rotate(this.rotation),s=h.scale(this.scale.x,this.scale.y);return t.multiplyMatrix(e).multiplyMatrix(s)}tweenPosition(t,e,s,i,r){const a=new V((e=>{r&&t.add(a._startValue),this.position=n.lerpVector(e,a._startValue,t)}),(()=>this.position),e,s,i);return a}tweenPositionX(t,e,s,i,r){const a=new V((e=>{r&&(t+=a._startValue),this.position.x=n.lerpNumber(e,a._startValue,t)}),(()=>this.position.x),e,s,i);return a}tweenPositionY(t,e,s,i,r){const a=new V((e=>{r&&(t+=a._startValue),this.position.y=n.lerpNumber(e,a._startValue,t)}),(()=>this.position.y),e,s,i);return a}tweenScale(t,e,s,i,r){const a=new V((e=>{r&&t.add(a._startValue),this.scale=n.lerpVector(e,a._startValue,t)}),(()=>this.scale),e,s,i);return a}},Y=class extends C{constructor(t){super(t),this.type=m.RENDERER,this._componentRequirements=[m.TRANSFORM],this.drawOrder=0,this.ownerTransform=t.getComponent(m.TRANSFORM),c._registerRenderer(this)}_localToWorldMatrix(){return this.ownerTransform._localToWorldMatrix()}setDrawable(t){this.drawable=t}_draw(){this.owner.isVisible&&this.drawable._draw()}tweenColor(t,e,s,i,r){const a=new V((e=>{r&&t.add(a._startValue),this.drawable.color=n.lerpColor(e,a._startValue,t)}),(()=>this.drawable.color),e,s,i);return a}};class K extends Y{constructor(t){super(t),this._componentRequirements=[m.TRANSFORM],this.anchor=Q.MID_CENTER,this.pivot=Q.MID_CENTER}get rect(){const t=this.owner.getComponent(m.TRANSFORM);return new w(t.position,this.elementSize)}_draw(){if(!this.owner.isVisible)return;let t=a.ZERO;switch(this.pivot){case Q.TOP_LEFT:t=new a(0,0);break;case Q.TOP_CENTER:t=new a(-.5,0);break;case Q.TOP_RIGHT:t=new a(-1,0);break;case Q.MID_LEFT:t=new a(0,-.5);break;case Q.MID_CENTER:t=new a(-.5,-.5);break;case Q.MID_RIGHT:t=new a(-1,-.5);break;case Q.BOTTOM_LEFT:t=new a(0,-1);break;case Q.BOTTOM_CENTER:t=new a(-.5,-1);break;case Q.BOTTOM_RIGHT:t=new a(-1,-1)}this.drawable.offSet=this.elementSize.multiplyComp(t),this.drawable._draw()}}var Q;!function(t){t[t.TOP_LEFT=0]="TOP_LEFT",t[t.TOP_CENTER=1]="TOP_CENTER",t[t.TOP_RIGHT=2]="TOP_RIGHT",t[t.MID_LEFT=3]="MID_LEFT",t[t.MID_CENTER=4]="MID_CENTER",t[t.MID_RIGHT=5]="MID_RIGHT",t[t.BOTTOM_LEFT=6]="BOTTOM_LEFT",t[t.BOTTOM_CENTER=7]="BOTTOM_CENTER",t[t.BOTTOM_RIGHT=8]="BOTTOM_RIGHT"}(Q||(Q={}));const j=class extends K{constructor(t){super(t),this.clicked=new p,this.hovered=new p,u.registerMouseInteractable(this)}_click(t){this.rect.isPointInside(t)&&u.getMouseDown()&&this.clicked.invoke()}_hover(t){this.rect.isPointInside(t)&&this.hovered.invoke()}},$=class extends K{constructor(t){super(t)}setDrawable(t){super.setDrawable(t);const e=c._canvasContext.measureText(t.text);e.fontBoundingBoxAscent,e.fontBoundingBoxDescent,e.actualBoundingBoxAscent,e.actualBoundingBoxDescent,this.elementSize=a.ZERO}},q=class{constructor(t){this.isActive=!0,this.isVisible=!0,this.parentNode=null,this.childNodes=[],this.components=[],this.name=t,W._registerNode(this),this.init()}init(){}start(){}update(){}destroy(){}_executeStart(){this.start();for(let t=0;t<this.childNodes.length;t++)this.childNodes[t]._executeStart()}_executeUpdate(){if(this.isActive){this.update();for(let t=0;t<this.childNodes.length;t++)this.childNodes[t]._executeUpdate()}}getComponent(e){const s=this.components.filter((t=>t.type===e));return 0===s.length&&t.logError(`Component of type ${e} not found on actor ${this.name}`),s[0]}addComponent(e){const s=this.components.findIndex((t=>t.type===e));if(-1!==s)return t.logError(`Component of type ${e} already exists on actor ${this.name}.`),this.components[s];let i;switch(e){case m.TRANSFORM:i=new X(this);break;case m.RENDERER:i=new Y(this);break;case m.RECTANGLE_COLLIDER:i=new f(this);break;case m.CIRCLE_COLLIDER:i=new E(this);break;case m.BUTTON:i=new j(this);break;case m.TEXT:i=new $(this)}for(const e of i._componentRequirements)if(-1==this.components.findIndex((t=>t.type==e)))return void t.logError(`Component of type ${i} requires component of type ${e}.`);return this.components.push(i),i}removeComponent(t){}setChild(t){this.childNodes.includes(t)||(this.childNodes.push(t),t.parentNode=this)}removeChild(t){this.childNodes.includes(t)&&(this.childNodes=this.childNodes.filter((e=>e!==t)),t.parentNode=null)}setParent(t){t.setChild(this)}removeParent(){null!==this.parentNode&&this.parentNode.removeChild(this)}},J=class{constructor(t=""){this.saturation=70,this.maxWidth=100,this.maxHeight=100,this.flipX=!1,this.flipY=!1,this.scale=a.ONE,this.setImage(t)}_draw(){c._canvasContext.scale(this.scale.x*(this.flipX?-1:1),this.scale.y*(this.flipY?-1:1)),c._canvasContext.drawImage(this._image,-this._image.width/2,-this._image.height/2)}setImage(t){this._image=new Image,this._image.src=t}tweenSaturation(t,e,s,i,r){const a=new V((e=>{r&&(t+=a._startValue),this.saturation=n.lerpNumber(e,a._startValue,t)}),(()=>this.saturation),e,s,i);return a}};var Z;!function(t){t[t.WELCOME=0]="WELCOME",t[t.PLAY=1]="PLAY",t[t.RESULT=2]="RESULT"}(Z||(Z={}));const tt=Z,et=class{constructor(t,e){this.color=e,this.size=t}_draw(){c._canvasContext.fillStyle=this.color.toString(),c._canvasContext.beginPath(),c._canvasContext.arc(0,0,this.size,0,2*Math.PI),c._canvasContext.fill()}},st=class extends q{constructor(t,e){super(t),this.transform=this.addComponent(m.TRANSFORM),this.transform.tweenScale(a.ONE.multiply(.2),.2,0,I.IN_EXPO,!1),this.transform.position=new a(e.x,e.y);const i=new et(8,new s(.93,.2,.38));this.renderer=this.addComponent(m.RENDERER),this.renderer.setDrawable(i),this.renderer.drawOrder=0,this.renderer.tweenColor(s.CLEAR,.2,0,I.IN_EXPO,!1)}},it=class extends q{constructor(){super(...arguments),this.isLocked=!0,this.isAlive=!0,this.lastJumpTime=0,this.isMovingRight=!0,this.moveSpeed=235,this.jumpCurveXCoeff=2.6,this.jumpCurveYCoeff=100,this.jumpSpriteTimeout=.4,this.jumpSpriteTimer=.4,this.trailDotSpawnTimeout=.07,this.trailDotSpawnTimer=.07,this.trailDotEffectiveTime=.4}init(){this.transform=this.addComponent(m.TRANSFORM),this.transform.position=new a(50,100),this.lastJumpTime=R.timeSinceGameStart(),this.lastJumpPosY=this.transform.position.y,this.collider=this.addComponent(m.RECTANGLE_COLLIDER),this.collider.size=new a(20,20),this.collider.collisionStarted.subscribe(this.handleCollisionStart.bind(this));const t=new J("./assets/kenney/Characters/character_0000.png");this.renderer=this.addComponent(m.RENDERER),this.renderer.setDrawable(t),this.renderer.drawOrder=5,this.touchedLeftWall=new p,this.touchedRightWall=new p,this.touchedLeftWall.subscribe(this.turnRight.bind(this)),this.touchedRightWall.subscribe(this.turnLeft.bind(this)),this.touchedLeftWall.subscribe(this.wallTouchedHandler.bind(this)),this.touchedRightWall.subscribe(this.wallTouchedHandler.bind(this)),this.touchedLeftWall.subscribe((()=>this.scoreChanged.invoke(St.currentScore))),this.touchedRightWall.subscribe((()=>this.scoreChanged.invoke(St.currentScore))),this.jumpSprite=new J("assets/Jump.png"),this.jumpSprite.scale=a.ONE.multiply(.12),this.glideSprite=new J("assets/Glide.png"),this.glideSprite.scale=a.ONE.multiply(.12),this.scoreChanged=new T,this.turnRight(),St.gameStateChanged.subscribe(this.gameStateChangedHandler.bind(this))}update(){if(this.isLocked)return void this.playIdleAnimation();this.isAlive&&this.move(),(u.getKeyDown(" ")||u.getMouseDown())&&this.jump();const t=R.timeSinceGameStart()-this.lastJumpTime;this.transform.position.y=this.jumpYFunction(t),this.jumpSpriteTimer-=R.deltaTime(),this.jumpSpriteTimer<0&&this.renderer.setDrawable(this.glideSprite),this.handleSpawnTrailDot()}turnLeft(){this.isMovingRight=!1,this.jumpSprite.flipX=!1,this.glideSprite.flipX=!1}turnRight(){this.isMovingRight=!0,this.jumpSprite.flipX=!0,this.glideSprite.flipX=!0}gameStateChangedHandler(t){t===tt.WELCOME?(this.isLocked=!0,this.transform.position.x=0,this.dieSaturationTween&&this.dieSaturationTween.end(),this.glideSprite.saturation=70):t===tt.PLAY?(this.glideSprite.saturation=70,this.isAlive=!0,this.isLocked=!1,this.jump()):tt.RESULT}move(){this.isMovingRight?this.transform.position.x+=R.deltaTime()*this.moveSpeed:this.transform.position.x-=R.deltaTime()*this.moveSpeed}jump(){this.isAlive&&(this.renderer.setDrawable(this.jumpSprite),this.lastJumpTime=R.timeSinceGameStart(),this.lastJumpPosY=this.transform.position.y,this.jumpSpriteTimer=this.jumpSpriteTimeout)}jumpYFunction(t){const e=t*this.jumpCurveXCoeff;return(1-Math.pow(e-1,2))*this.jumpCurveYCoeff+this.lastJumpPosY}handleCollisionStart(t){"Wall"===t.owner.name?this.isMovingRight?this.touchedRightWall.invoke():this.touchedLeftWall.invoke():"Spike"===t.owner.name&&(this.isAlive=!1,St.changeState(tt.RESULT))}wallTouchedHandler(){this.isAlive&&St.currentScore++}playIdleAnimation(){Math.round(R.timeSinceGameStart())%2==0?this.renderer.setDrawable(this.glideSprite):this.renderer.setDrawable(this.jumpSprite),this.transform.position.y=20*Math.sin(R.timeSinceGameStart())-10}handleSpawnTrailDot(){this.isAlive&&!(R.timeSinceGameStart()-this.lastJumpTime>this.trailDotEffectiveTime)&&(this.trailDotSpawnTimer-=R.deltaTime(),this.trailDotSpawnTimer<0)&&(new st("Dot",this.transform.position).start(),this.trailDotSpawnTimer=this.trailDotSpawnTimeout)}},nt=class{constructor(t,e){this.color=e,this.size=t,this.offSet=new a(-this.size.x/2,-this.size.y/2)}_draw(){c._canvasContext.fillStyle=this.color.toString(),c._canvasContext.fillRect(this.offSet.x,this.offSet.y,this.size.x,this.size.y)}},rt=class{constructor(t,e=s.BLACK){this.text=t,this.color=e}_draw(){c._canvasContext.font=this.font,c._canvasContext.textAlign="center",c._canvasContext.textBaseline="middle",c._canvasContext.fillStyle=this.color.toString(),c._canvasContext.fillText(this.text,this.offSet.x,this.offSet.y);const t=c._canvasContext.measureText(this.text),e=(t.fontBoundingBoxAscent,t.fontBoundingBoxDescent,t.actualBoundingBoxAscent+t.actualBoundingBoxDescent);new a(t.width,e)}},at=class extends q{init(){this.transform=this.addComponent(m.TRANSFORM),this.transform.position=new a(0,-100);const t=new nt(new a(200,100),s.WHITE);this.button=this.addComponent(m.BUTTON),this.button.elementSize=new a(200,100),this.button.setDrawable(t),this.button.pivot=Q.MID_CENTER;const e=new rt("Play",s.GREY);e.font="30px tahoma",this.text=this.addComponent(m.TEXT),this.text.setDrawable(e),this.button.clicked.subscribe(this.changeToPlayState.bind(this)),St.gameStateChanged.subscribe(this.gameStateChangedHandler.bind(this))}gameStateChangedHandler(t){t==tt.WELCOME?(this.isVisible=!0,this.isActive=!0):(this.isVisible=!1,this.isActive=!1)}changeToPlayState(){St.changeState(tt.PLAY)}},ot=class extends q{constructor(t){super(t),this.spikes=[],this.transform=this.addComponent(m.TRANSFORM),this.collider=this.addComponent(m.RECTANGLE_COLLIDER)}},ht=class{static getPrimaryColor(t){return t<5?s.GREY:t<10?s.fromHex("1982c4"):t<15?s.fromHex("ff924c"):t<20?s.fromHex("8ac926"):t<25?s.fromHex("ff595e"):t<30?s.fromHex("ffca3a"):s.fromHex("6a4c93")}static getSecondaryColor(t){return t<5?s.WHITE:t<10?s.fromHex("d3eefc"):t<15?s.fromHex("ffe7e5"):t<20?s.fromHex("e2f0cb"):t<25?s.fromHex("ff9aa2"):t<30?s.fromHex("fcf6bd"):s.fromHex("c7ceea")}},lt=class extends q{init(){this.transform=this.addComponent(m.TRANSFORM),this.collider=this.addComponent(m.RECTANGLE_COLLIDER),this.collider.size=new a(50,40),this.triangle=new class{constructor(t){this.color=t}_draw(){c._canvasContext.fillStyle=this.color.toString(),c._canvasContext.beginPath();for(let t=0;t<this._points.length;t++)c._canvasContext.lineTo(this._points[t].x,this._points[t].y);c._canvasContext.fill()}setPoints(t){this._points=t}}(s.GREY),this.triangle.setPoints([new a(25,0),new a(0,25),new a(-25,0),new a(0,-25)]),this.renderer=this.addComponent(m.RENDERER),this.renderer.setDrawable(this.triangle),this.renderer.drawOrder=100,St.scoreChanged.subscribe(this.scoreChangedHandler.bind(this))}start(){this.showingPosX=200*n.sign(this.transform.position.x),this.hidingPosX=250*n.sign(this.transform.position.x)}show(){this.collider.isActive=!0,this.transform.tweenPositionX(this.showingPosX,.15,0,I.LINEAR,!1)}hide(){this.collider.isActive=!1,this.transform.tweenPositionX(this.hidingPosX,.15,0,I.LINEAR,!1)}scoreChangedHandler(t){this.renderer.tweenColor(ht.getPrimaryColor(t),.3,0,I.OUT_CUBIC,!1)}},ct=class extends ot{constructor(t){super(t),St.gameStateChanged.subscribe(this.stateChangedHandler.bind(this))}start(){this.collider.size=new a(100,600);for(let t=-200;t<=200;t+=50){const e=new lt("Spike");e.setParent(this),e.transform.position=new a(this.transform.position.x,t),e.start(),this.spikes.push(e)}}showSpike(){const t=this.difficultyFunction(St.currentScore),e=n.randomIntBag(0,this.spikes.length,t);for(let t=0;t<e.length;t++)this.spikes[e[t]].show()}hideSpike(){for(let t=0;t<this.spikes.length;t++)this.spikes[t].hide()}stateChangedHandler(t){t===tt.WELCOME&&this.hideSpike()}difficultyFunction(t){return Math.floor(Math.log(t+2)/Math.log(1.6)*.8)}},dt=class extends ot{constructor(t){super(t),this.collider.size=new a(400,100),this.renderer=this.addComponent(m.RENDERER),this.renderer.drawOrder=100,this.rectangle=new nt(new a(400,100),s.GREY),this.renderer.setDrawable(this.rectangle),St.scoreChanged.subscribe(this.scoreChangedHandler.bind(this))}start(){for(let t=-200;t<=200;t+=50){const e=new lt("Spike");e.setParent(this);const s=t,i=250*n.sign(this.transform.position.y);e.transform.position=new a(s,i),e.start(),this.spikes.push(e)}}scoreChangedHandler(t){this.renderer.tweenColor(ht.getPrimaryColor(t),.3,0,I.OUT_CUBIC,!1)}},ut=class extends q{constructor(t){super(t),this.transform=this.addComponent(m.TRANSFORM),this.textContent=new rt("00",new s(1,1,1,.5)),this.textContent.font="100px tahoma",this.text=this.addComponent(m.TEXT),this.text.setDrawable(this.textContent),this.text.pivot=Q.MID_CENTER,this.text.drawOrder=-1,St.gameStateChanged.subscribe(this.gameStateChangedHandler.bind(this))}changeScore(t){this.textContent.text=t.toString()}gameStateChangedHandler(t){t===tt.PLAY?(this.textContent.text="0",this.isVisible=!0,this.isActive=!0):(this.isVisible=!1,this.isActive=!1)}},_t=class extends q{constructor(t){super(t),this.transform=this.addComponent(m.TRANSFORM);const e=new et(100,new s(.1,.1,.1,.15));this.renderer=this.addComponent(m.RENDERER),this.renderer.setDrawable(e),this.renderer.drawOrder=-2,St.gameStateChanged.subscribe(this.gameStateChangedHandler.bind(this))}gameStateChangedHandler(t){t==tt.PLAY?(this.isVisible=!0,this.isActive=!0):(this.isVisible=!1,this.isActive=!1)}},mt=class extends q{constructor(t){super(t),this.transform=this.addComponent(m.TRANSFORM);const e=new nt(new a(400,150),new s(.5,.5,.5,.5));this.renderer=this.addComponent(m.RENDERER),this.renderer.setDrawable(e),this.renderer.drawOrder=100,St.gameStateChanged.subscribe(this.gameStateChangedHandler.bind(this))}gameStateChangedHandler(t){t===tt.RESULT?(this.isActive=!0,this.isVisible=!0):(this.isActive=!1,this.isVisible=!1)}},Ct=class extends q{constructor(t){super(t),this.transform=this.addComponent(m.TRANSFORM),this.transform.position=new a(0,30),this.textContent=new rt("",s.WHITE),this.textContent.font="30px tahoma",this.text=this.addComponent(m.TEXT),this.text.setDrawable(this.textContent),this.text.pivot=Q.MID_CENTER,this.text.drawOrder=200,St.gameStateChanged.subscribe(this.gameStateChangedHandler.bind(this))}gameStateChangedHandler(t){t==tt.RESULT?(this.isVisible=!0,this.isActive=!0,this.textContent.text=`Current score: ${St.currentScore}`):(this.isVisible=!1,this.isActive=!1)}},pt=class extends q{constructor(t){super(t),this.transform=this.addComponent(m.TRANSFORM),this.transform.position=new a(0,-30),this.textContent=new rt("00",s.WHITE),this.textContent.font="30px tahoma",this.text=this.addComponent(m.TEXT),this.text.setDrawable(this.textContent),this.text.pivot=Q.MID_CENTER,this.text.drawOrder=200,St.gameStateChanged.subscribe(this.gameStateChangedHandler.bind(this))}gameStateChangedHandler(t){t==tt.RESULT?(this.isVisible=!0,this.isActive=!0,this.textContent.text=`High score: ${St.highScore}`):(this.isVisible=!1,this.isActive=!1)}},Tt=class extends q{init(){this.transform=this.addComponent(m.TRANSFORM),this.transform.position=new a(0,-150);const t=new nt(new a(200,100),s.WHITE);this.button=this.addComponent(m.BUTTON),this.button.elementSize=new a(200,100),this.button.setDrawable(t),this.button.pivot=Q.MID_CENTER;const e=new rt("Retry",s.GREY);e.font="30px tahoma",this.text=this.addComponent(m.TEXT),this.text.setDrawable(e),this.button.clicked.subscribe(this.changeToPlayState.bind(this)),St.gameStateChanged.subscribe(this.gameStateChangedHandler.bind(this))}gameStateChangedHandler(t){t==tt.RESULT?(this.isVisible=!0,this.isActive=!0):(this.isVisible=!1,this.isActive=!1)}changeToPlayState(){St.changeState(tt.WELCOME)}},gt=class extends q{constructor(t){super(t),this.transform=this.addComponent(m.TRANSFORM),this.rectangle=new nt(c.canvasSize,s.WHITE),this.renderer=this.addComponent(m.RENDERER),this.renderer.setDrawable(this.rectangle),this.renderer.drawOrder=-100,St.scoreChanged.subscribe(this.scoreChangedHandler.bind(this))}scoreChangedHandler(t){this.renderer.tweenColor(ht.getSecondaryColor(t),.3,0,I.OUT_CUBIC,!1)}};class wt extends q{constructor(t){super(t),this.transform=this.addComponent(m.TRANSFORM),this.transform.position=new a(0,150),this.textContent=new rt("DON'T TOUCH",s.GREY),this.textContent.font="60px tahoma",this.text=this.addComponent(m.TEXT),this.text.setDrawable(this.textContent),this.text.pivot=Q.MID_CENTER,this.text.drawOrder=200,St.gameStateChanged.subscribe(this.gameStateChangedHandler.bind(this))}gameStateChangedHandler(t){t==tt.WELCOME?(this.isVisible=!0,this.isActive=!0):(this.isVisible=!1,this.isActive=!1)}}class ft extends q{constructor(t){super(t),this.transform=this.addComponent(m.TRANSFORM),this.transform.position=new a(0,80),this.textContent=new rt("THE SPIKE",s.GREY),this.textContent.font="60px tahoma",this.text=this.addComponent(m.TEXT),this.text.setDrawable(this.textContent),this.text.pivot=Q.MID_CENTER,this.text.drawOrder=200,St.gameStateChanged.subscribe(this.gameStateChangedHandler.bind(this))}gameStateChangedHandler(t){t==tt.WELCOME?(this.isVisible=!0,this.isActive=!0):(this.isVisible=!1,this.isActive=!1)}}class Et extends W{static get currentScore(){return Et._currentScore}static set currentScore(t){Et._currentScore=t,Et.scoreChanged.invoke(t)}static changeState(t){Et.gameState=t,Et.gameStateChanged.invoke(t)}static stateChangeHandler(t){t===tt.WELCOME?Et.currentScore=0:t===tt.PLAY||t===tt.RESULT&&Et.highScore<Et._currentScore&&(Et.highScore=Et._currentScore)}static init(t){super.init(t),Et.gameStateChanged.subscribe(Et.stateChangeHandler.bind(Et)),new gt("Game Background").start(),new wt("Title").start(),new ft("Title").start();const e=new it("Main Bird");e.start();const s=new ct("Wall");s.transform.position=new a(-250,0),s.start();const i=new ct("Wall");i.transform.position=new a(250,0),i.start(),e.touchedLeftWall.subscribe((()=>{s.hideSpike(),i.showSpike()})),e.touchedRightWall.subscribe((()=>{i.hideSpike(),s.showSpike()}));const n=new dt("Top Wall");n.transform.position=new a(0,300),n.start();const r=new dt("Bottom Wall");r.transform.position=new a(0,-300),r.start(),new _t("Score Background").start();const o=new ut("Score Text");e.scoreChanged.subscribe(o.changeScore.bind(o)),o.start(),new at("Play Button").start(),new mt("Result Background").start(),new Ct("Result Score").start(),new pt("High Score").start(),new Tt("Retry Button").start(),Et.changeState(tt.WELCOME),console.log(h.IDENTITY)}}Et.highScore=0,Et.scoreChanged=new T,Et.gameState=tt.WELCOME,Et.gameStateChanged=new T,Et._currentScore=0;const St=Et;new class{constructor(){const t=document.getElementById("game"),e=document.createElement("canvas");e.id="canvas",e.width=400,e.height=600,null==t||t.appendChild(e),St.init(e.getContext("2d"))}}})();